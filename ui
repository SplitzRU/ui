--[[
    OT UI Library v2 (Redesigned)
    "Uniqueness" Edition - Combined Standalone
    
    Features:
    - Glassmorphism / Cyber Aesthetic
    - Home Dashboard with 3D Character Viewport
    - Spotlight Search
    - Fluid Animations & Ripples
    - Fully API Compatible
]]

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local ContentProvider = game:GetService("ContentProvider")
local GuiService = game:GetService("GuiService")

local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

-- Device Detection
local IS_MOBILE = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled
local IS_CONSOLE = UserInputService.GamepadEnabled and not UserInputService.KeyboardEnabled

--// Theme System (Dark Monochrome)
local Theme = {
    Background = Color3.fromRGB(12, 12, 12),
    Sidebar = Color3.fromRGB(16, 16, 16),
    Content = Color3.fromRGB(14, 14, 14),
    Section = Color3.fromRGB(22, 22, 22),
    Element = Color3.fromRGB(30, 30, 30),
    Text = Color3.fromRGB(245, 245, 245),
    SubText = Color3.fromRGB(140, 140, 140),
    Accent = Color3.fromRGB(255, 255, 255), -- Pure White
    AccentEnd = Color3.fromRGB(180, 180, 180), -- Light Gray
    Outline = Color3.fromRGB(45, 45, 45),
    Success = Color3.fromRGB(120, 255, 120),
    Warning = Color3.fromRGB(255, 220, 100),
    Danger = Color3.fromRGB(255, 100, 100),
}

--// Utils
local Library = {}
local Utility = {}

local HttpService = game:GetService("HttpService")
local CONFIG_FOLDER = "OTConfigs"

--// Config System
local function ensureFolder()
    if makefolder and isfolder and not isfolder(CONFIG_FOLDER) then
        makefolder(CONFIG_FOLDER)
    end
end

local function saveConfig(name, data)
    ensureFolder()
    if writefile then
        writefile(CONFIG_FOLDER .. "/" .. name .. ".json", HttpService:JSONEncode(data))
        return true
    end
    return false
end

local function loadConfig(name)
    if readfile and isfile and isfile(CONFIG_FOLDER .. "/" .. name .. ".json") then
        local success, data = pcall(function()
            return HttpService:JSONDecode(readfile(CONFIG_FOLDER .. "/" .. name .. ".json"))
        end)
        if success then return data end
    end
    return nil
end

local function deleteConfig(name)
    if delfile and isfile and isfile(CONFIG_FOLDER .. "/" .. name .. ".json") then
        delfile(CONFIG_FOLDER .. "/" .. name .. ".json")
        return true
    end
    return false
end

local function listConfigs()
    local configs = {}
    if listfiles and isfolder and isfolder(CONFIG_FOLDER) then
        for _, file in ipairs(listfiles(CONFIG_FOLDER)) do
            local name = file:match("([^/\\]+)%.json$")
            if name and name ~= "_autoload" then table.insert(configs, name) end
        end
    end
    return configs
end

local function setAutoLoadConfig(name)
    ensureFolder()
    if writefile then
        writefile(CONFIG_FOLDER .. "/_autoload.txt", name or "")
        return true
    end
    return false
end

local function getAutoLoadConfig()
    if readfile and isfile and isfile(CONFIG_FOLDER .. "/_autoload.txt") then
        local name = readfile(CONFIG_FOLDER .. "/_autoload.txt")
        if name and name ~= "" then return name end
    end
    return nil
end

local function clearAutoLoadConfig()
    if delfile and isfile and isfile(CONFIG_FOLDER .. "/_autoload.txt") then
        delfile(CONFIG_FOLDER .. "/_autoload.txt")
        return true
    end
    return false
end

function Utility:Tween(instance, tweenInfo, properties)
    local tween = TweenService:Create(instance, tweenInfo, properties)
    tween:Play()
    return tween
end

function Utility:Ripple(button, color)
    task.spawn(function()
        local ripple = Instance.new("ImageLabel")
        ripple.Name = "Ripple"
        ripple.BackgroundColor3 = color or Color3.fromRGB(255, 255, 255)
        ripple.BackgroundTransparency = 0.8
        ripple.BorderSizePixel = 0
        ripple.Image = "rbxassetid://2708891598"
        ripple.ImageColor3 = color or Color3.fromRGB(255, 255, 255)
        ripple.ImageTransparency = 0.6
        ripple.ZIndex = 9
        ripple.Parent = button
        
        -- Calculate position (center of mouse or center of button)
        local mousePos = UserInputService:GetMouseLocation()
        local btnAbsPos = button.AbsolutePosition
        local btnAbsSize = button.AbsoluteSize
        
        -- Relative mouse position
        local x = mousePos.X - btnAbsPos.X
        local y = mousePos.Y - btnAbsPos.Y - 36 -- Account for GuiInset usually
        
        ripple.Position = UDim2.new(0, x, 0, y)
        ripple.Size = UDim2.new(0, 0, 0, 0)
        ripple.AnchorPoint = Vector2.new(0.5, 0.5)
        
        local maxSize = math.max(btnAbsSize.X, btnAbsSize.Y) * 2.5
        
        Utility:Tween(ripple, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, maxSize, 0, maxSize),
            ImageTransparency = 1
        })
        
        task.wait(0.5)
        ripple:Destroy()
    end)
end

function Utility:Create(class, props)
    local inst = Instance.new(class)
    for k, v in pairs(props) do
        if k ~= "Parent" then
            inst[k] = v
        end
    end
    if props.Parent then inst.Parent = props.Parent end
    return inst
end

function Utility:Corner(parent, radius)
    return Utility:Create("UICorner", {
        CornerRadius = UDim.new(0, radius),
        Parent = parent
    })
end

function Utility:Stroke(parent, color, thickness)
    return Utility:Create("UIStroke", {
        Color = color or Theme.Outline,
        Thickness = thickness or 1,
        ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
        Parent = parent
    })
end

function Utility:Gradient(parent, c1, c2, rot)
    return Utility:Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, c1 or Theme.Accent),
            ColorSequenceKeypoint.new(1, c2 or Theme.AccentEnd)
        }),
        Rotation = rot or 45,
        Parent = parent
    })
end

function Utility:ParticleEffect(parent, color)
    task.spawn(function()
        local particles = {}
        for i = 1, 8 do
            local particle = Utility:Create("Frame", {
                Size = UDim2.new(0, 4, 0, 4),
                Position = UDim2.fromScale(0.5, 0.5),
                AnchorPoint = Vector2.new(0.5, 0.5),
                BackgroundColor3 = color or Theme.Accent,
                BorderSizePixel = 0,
                Parent = parent,
                ZIndex = 100
            })
            Utility:Corner(particle, 2)
            table.insert(particles, particle)
            
            local angle = (math.pi * 2 / 8) * i
            local distance = math.random(25, 45)
            
            Utility:Tween(particle, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Position = UDim2.new(0.5, math.cos(angle) * distance, 0.5, math.sin(angle) * distance),
                BackgroundTransparency = 1,
                Size = UDim2.new(0, 0, 0, 0)
            })
        end
        task.wait(0.5)
        for _, p in pairs(particles) do
            if p and p.Parent then p:Destroy() end
        end
    end)
end

--// Main Library
function Library.new(opts)
    -- Support both string and table input
    if type(opts) == "string" then
        opts = {Title = opts}
    end
    opts = opts or {}
    local title = opts.Title or "UI Library"
    
    local Window = {}
    Window.Tabs = {}
    Window.Elements = {} -- For search
    Window._configValues = {} -- Stores current config values
    Window._configCallbacks = {} -- Callbacks to update UI when config loads
    Window._toggleKey = Enum.KeyCode.LeftControl
    
    -- Protect GUI
    local ScreenGui = Utility:Create("ScreenGui", {
        Name = "OT_V2",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 0, -- Default display order, doesn't override other UIs
        Parent = Player:WaitForChild("PlayerGui")
    })
    
    -- Only remove blur effects created by THIS library (tagged with our name)
    -- Do NOT destroy other UIs' blur effects
    for _, v in pairs(game:GetService("Lighting"):GetChildren()) do
        if v:IsA("BlurEffect") and v.Name == "OT_V2_Blur" then
            v:Destroy()
        end
    end
    
    -- Responsive sizing for mobile vs desktop
    local screenSize = workspace.CurrentCamera.ViewportSize
    local mainSize
    if IS_MOBILE then
        -- Mobile: Use percentage of screen, max out at reasonable size
        local width = math.min(screenSize.X * 0.95, 780)
        local height = math.min(screenSize.Y * 0.85, 500)
        mainSize = UDim2.new(0, width, 0, height)
    else
        -- Desktop: Fixed size
        mainSize = UDim2.new(0, 780, 0, 500)
    end
    
    -- Main Container
    local Main = Utility:Create("Frame", {
        Name = "Main",
        Size = mainSize,
        Position = UDim2.fromScale(0.5, 0.5),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.05, -- Glass-ish
        BorderSizePixel = 0,
        Parent = ScreenGui,
        ClipsDescendants = true
    })
    Utility:Corner(Main, IS_MOBILE and 8 or 12)
    Utility:Stroke(Main, Theme.Outline, 1)
    
    -- Handle screen rotation/resize on mobile
    if IS_MOBILE then
        workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(function()
            local newScreenSize = workspace.CurrentCamera.ViewportSize
            local newWidth = math.min(newScreenSize.X * 0.95, 780)
            local newHeight = math.min(newScreenSize.Y * 0.85, 500)
            Main.Size = UDim2.new(0, newWidth, 0, newHeight)
        end)
    end
    
    -- Scale for open animation
    local Scale = Utility:Create("UIScale", {
        Scale = 0,
        Parent = Main
    })
    
    --// Layout
    -- Sidebar (narrower on mobile)
    local sidebarWidth = IS_MOBILE and 140 or 180
    local Sidebar = Utility:Create("Frame", {
        Name = "Sidebar",
        Size = UDim2.new(0, sidebarWidth, 1, 0),
        BackgroundColor3 = Theme.Sidebar,
        BorderSizePixel = 0,
        Parent = Main,
        ZIndex = 2
    })
    Utility:Corner(Sidebar, IS_MOBILE and 8 or 12)
    
    local SideCover = Utility:Create("Frame", {
        Size = UDim2.new(0, 10, 1, 0),
        Position = UDim2.new(1, -10, 0, 0),
        BackgroundColor3 = Theme.Sidebar,
        BorderSizePixel = 0,
        Parent = Sidebar
    })
    
    -- Profile / Header in Sidebar
    local Profile = Utility:Create("Frame", {
        Size = UDim2.new(1, 0, 0, 70),
        BackgroundTransparency = 1,
        Parent = Sidebar
    })
    
    local Avatar = Utility:Create("ImageLabel", {
        Size = UDim2.new(0, 40, 0, 40),
        Position = UDim2.new(0, 14, 0, 15),
        BackgroundColor3 = Theme.Element,
        BackgroundTransparency = 0.5,
        Image = Players:GetUserThumbnailAsync(Player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100),
        Parent = Profile
    })
    Utility:Corner(Avatar, 20)
    Utility:Stroke(Avatar, Theme.Accent, 1)
    
    local TitleLbl = Utility:Create("TextLabel", {
        Text = title or "OT",
        Size = UDim2.new(1, -70, 0, 20),
        Position = UDim2.new(0, 64, 0, 16),
        BackgroundTransparency = 1,
        TextColor3 = Theme.Text,
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = Profile
    })
    
    local UserLbl = Utility:Create("TextLabel", {
        Text = Player.DisplayName,
        Size = UDim2.new(1, -70, 0, 16),
        Position = UDim2.new(0, 64, 0, 36),
        BackgroundTransparency = 1,
        TextColor3 = Theme.SubText,
        Font = Enum.Font.Gotham,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = Profile
    })
    
    -- Navigation Container
    local NavScroll = Utility:Create("ScrollingFrame", {
        Size = UDim2.new(1, 0, 1, -120),
        Position = UDim2.new(0, 0, 0, 80),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 2,
        ScrollBarImageColor3 = Theme.Accent,
        Parent = Sidebar,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollingDirection = Enum.ScrollingDirection.Y,
        ElasticBehavior = Enum.ElasticBehavior.Never
    })
    local NavLayout = Utility:Create("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 6),
        Parent = NavScroll
    })
    Utility:Create("UIPadding", {
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        Parent = NavScroll
    })
    
    -- Content Area (adjusts based on sidebar width)
    local Content = Utility:Create("Frame", {
        Name = "Content",
        Size = UDim2.new(1, -sidebarWidth, 1, 0),
        Position = UDim2.new(0, sidebarWidth, 0, 0),
        BackgroundTransparency = 1,
        Parent = Main
    })
    
    -- Search Bar
    local TopBar = Utility:Create("Frame", {
        Size = UDim2.new(1, 0, 0, 50),
        BackgroundTransparency = 1,
        Parent = Content,
        ZIndex = 10
    })
    
    local SearchBg = Utility:Create("Frame", {
        Size = UDim2.new(1, -40, 0, 32),
        Position = UDim2.new(0, 20, 0, 10),
        BackgroundColor3 = Theme.Section,
        BackgroundTransparency = 0.5,
        Parent = TopBar,
        ZIndex = 10
    })
    Utility:Corner(SearchBg, 8)
    Utility:Stroke(SearchBg, Theme.Outline, 1)
    
    local SearchIcon = Utility:Create("ImageLabel", {
        Size = UDim2.new(0, 16, 0, 16),
        Position = UDim2.new(0, 10, 0.5, -8),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6031154871", -- Search icon
        ImageColor3 = Theme.SubText,
        Parent = SearchBg,
        ZIndex = 10
    })
    
    local SearchBox = Utility:Create("TextBox", {
        Size = UDim2.new(1, -34, 1, 0),
        Position = UDim2.new(0, 34, 0, 0),
        BackgroundTransparency = 1,
        Text = "",
        PlaceholderText = "Search features...",
        TextColor3 = Theme.Text,
        PlaceholderColor3 = Theme.SubText,
        Font = Enum.Font.Gotham,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = SearchBg,
        ZIndex = 10
    })
    
    -- Pages Container
    local Pages = Utility:Create("Frame", {
        Size = UDim2.new(1, 0, 1, -50),
        Position = UDim2.new(0, 0, 0, 50),
        BackgroundTransparency = 1,
        Parent = Content,
        ClipsDescendants = true
    })
    
    -- HOME PAGE
    local HomePage = Utility:Create("Frame", {
        Name = "Home",
        Size = UDim2.fromScale(1, 1),
        BackgroundTransparency = 1,
        Parent = Pages,
        Visible = true
    })
    
    -- 3D Character Viewport (hidden on mobile to save space)
    local Viewport = Utility:Create("ViewportFrame", {
        Size = UDim2.new(0, 250, 0, 350),
        Position = UDim2.new(0.85, -200, 0.5, -175),
        BackgroundTransparency = 1,
        Parent = HomePage,
        Visible = not IS_MOBILE, -- Hide on mobile
        Ambient = Color3.new(0.8, 0.8, 0.8),
        LightColor = Color3.new(1, 1, 1),
        LightDirection = Vector3.new(1, 1, 1),
    })
    
    local WorldModel = Utility:Create("WorldModel", {Parent = Viewport})
    local Camera = Utility:Create("Camera", {Parent = Viewport})
    Viewport.CurrentCamera = Camera
    
    -- Clone Character
    task.spawn(function()
        local char = Player.Character or Player.CharacterAdded:Wait()
        char.Archivable = true
        local clone = char:Clone()
        clone.Parent = WorldModel
        
        -- Strip scripts
        for _, v in pairs(clone:GetDescendants()) do
            if v:IsA("Script") or v:IsA("LocalScript") then v:Destroy() end
        end
        
        -- Pose
        local root = clone:WaitForChild("HumanoidRootPart")
        root.CFrame = CFrame.new(0, 0, 0)
        -- Raised character by lowering camera Y
        Camera.CFrame = CFrame.new(Vector3.new(0, 0.5, -6), root.Position + Vector3.new(0, 1.5, 0))
        
        -- Rotate
        RunService.RenderStepped:Connect(function()
            if clone and clone.Parent then
                root.CFrame = root.CFrame * CFrame.Angles(0, 0.01, 0)
        end
    end)
    end)
    
    -- Welcome Text (smaller on mobile)
    local WelcomeTitle = Utility:Create("TextLabel", {
        Text = "Welcome back,\n" .. Player.DisplayName,
        Size = IS_MOBILE and UDim2.new(0, 200, 0, 60) or UDim2.new(0, 300, 0, 80),
        Position = IS_MOBILE and UDim2.new(0, 15, 0, 20) or UDim2.new(0, 40, 0, 60),
        BackgroundTransparency = 1,
        TextColor3 = Theme.Text,
        Font = Enum.Font.GothamBold,
        TextSize = IS_MOBILE and 20 or 32,
        TextXAlignment = Enum.TextXAlignment.Left,
        RichText = true,
        Parent = HomePage
    })
    
    local WelcomeSub = Utility:Create("TextLabel", {
        Text = "OT UI Library v1.1 • Built by Ahmed",
        Size = IS_MOBILE and UDim2.new(0, 200, 0, 16) or UDim2.new(0, 300, 0, 20),
        Position = IS_MOBILE and UDim2.new(0, 15, 0, 75) or UDim2.new(0, 40, 0, 130),
        BackgroundTransparency = 1,
        TextColor3 = Theme.Accent,
        Font = Enum.Font.GothamMedium,
        TextSize = IS_MOBILE and 11 or 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = HomePage
    })
    
    -- Stats Cards (adjusted for mobile)
    local StatsContainer = Utility:Create("Frame", {
        Size = IS_MOBILE and UDim2.new(1, -30, 0, 150) or UDim2.new(0, 300, 0, 150),
        Position = IS_MOBILE and UDim2.new(0, 15, 0, 100) or UDim2.new(0, 40, 0, 180),
        BackgroundTransparency = 1,
        Parent = HomePage
    })
    Utility:Create("UIListLayout", {
        FillDirection = Enum.FillDirection.Vertical,
        Padding = UDim.new(0, 10),
        Parent = StatsContainer
    })
    
    local function CreateStatCard(icon, title, value)
        local card = Utility:Create("Frame", {
            Size = UDim2.new(1, 0, 0, 40),
            BackgroundColor3 = Theme.Section,
            Parent = StatsContainer
        })
        Utility:Corner(card, 6)
        Utility:Stroke(card, Theme.Outline, 1)
        
        Utility:Create("ImageLabel", {
            Size = UDim2.new(0, 20, 0, 20),
            Position = UDim2.new(0, 10, 0.5, -10),
            BackgroundTransparency = 1,
            Image = icon,
            ImageColor3 = Theme.Accent,
            Parent = card
        })
        
        Utility:Create("TextLabel", {
            Text = title,
            Size = UDim2.new(0, 100, 1, 0),
            Position = UDim2.new(0, 40, 0, 0),
            BackgroundTransparency = 1,
            TextColor3 = Theme.SubText,
            Font = Enum.Font.Gotham,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = card
        })
        
        return Utility:Create("TextLabel", {
            Text = value,
            Size = UDim2.new(0, 100, 1, 0),
            Position = UDim2.new(1, -110, 0, 0),
            BackgroundTransparency = 1,
            TextColor3 = Theme.Text,
            Font = Enum.Font.GothamBold,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Right,
            Parent = card
        })
    end
    
    local FPSLabel = CreateStatCard("rbxassetid://6031154871", "FPS", "60") -- Placeholder icon
    local PingLabel = CreateStatCard("rbxassetid://6031154871", "Ping", "-- ms")
    
    -- Additional Status Cards Row
    local StatusCards = Utility:Create("Frame", {
        Name = "StatusCards",
        Size = UDim2.new(0, 310, 0, 80),
        Position = UDim2.new(0, 40, 0, 280),
        BackgroundTransparency = 1,
        Parent = HomePage
    })
    
    local CardLayout = Utility:Create("UIListLayout", {
        FillDirection = Enum.FillDirection.Horizontal,
        Padding = UDim.new(0, 10),
        Parent = StatusCards
    })
    
    local function CreateStatusCard(title, value, color)
        local Card = Utility:Create("Frame", {
            Size = UDim2.new(0, 150, 0, 75),
            BackgroundColor3 = Theme.Section,
            Parent = StatusCards
        })
        Utility:Corner(Card, 10)
        Utility:Stroke(Card, Theme.Outline, 1)
        
        -- Accent bar at top
        local AccentBar = Utility:Create("Frame", {
            Size = UDim2.new(1, 0, 0, 3),
            BackgroundColor3 = color,
            Parent = Card
        })
        Utility:Corner(AccentBar, 2)
        
        -- Value (large number)
        local ValueLabel = Utility:Create("TextLabel", {
            Text = value,
            Size = UDim2.new(1, -15, 0, 24),
            Position = UDim2.new(0, 10, 0, 16),
            BackgroundTransparency = 1,
            TextColor3 = Theme.Text,
            Font = Enum.Font.GothamBold,
            TextSize = 20,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = Card
        })
        
        -- Title (small text)
        local TitleLabel = Utility:Create("TextLabel", {
            Text = title,
            Size = UDim2.new(1, -15, 0, 16),
            Position = UDim2.new(0, 10, 0, 44),
            BackgroundTransparency = 1,
            TextColor3 = Theme.SubText,
            Font = Enum.Font.Gotham,
            TextSize = 10,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = Card
        })
        
        return ValueLabel
    end
    
    local PlayTimeLabel = CreateStatusCard("Session Time", "0:00", Color3.fromRGB(100, 200, 255))
    
    -- License Status Card (PAID/FREE with VERIFIED)
    local isPaid = opts.IsPaid or false
    
    local LicenseCard = Utility:Create("Frame", {
        Size = UDim2.new(0, 150, 0, 75),
        BackgroundColor3 = Theme.Section,
        Parent = StatusCards
    })
    Utility:Corner(LicenseCard, 10)
    Utility:Stroke(LicenseCard, Theme.Outline, 1)
    
    -- Green accent bar at top
    local LicenseAccent = Utility:Create("Frame", {
        Size = UDim2.new(1, 0, 0, 3),
        BackgroundColor3 = Color3.fromRGB(100, 255, 130),
        Parent = LicenseCard
    })
    Utility:Corner(LicenseAccent, 2)
    
    -- Checkmark icon
    local CheckIcon = Utility:Create("TextLabel", {
        Text = "✓",
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(1, -58, 0, 18),
        BackgroundTransparency = 1,
        TextColor3 = Color3.fromRGB(100, 255, 130),
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        Parent = LicenseCard
    })
    
    -- PAID or FREE label
    local LicenseLabel = Utility:Create("TextLabel", {
        Text = isPaid and "PAID" or "FREE",
        Size = UDim2.new(1, -15, 0, 24),
        Position = UDim2.new(0, 10, 0, 16),
        BackgroundTransparency = 1,
        TextColor3 = isPaid and Color3.fromRGB(100, 255, 130) or Theme.Text,
        Font = Enum.Font.GothamBold,
        TextSize = 18,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = LicenseCard
    })
    
    -- VERIFIED subtitle
    local VerifiedLabel = Utility:Create("TextLabel", {
        Text = "VERIFIED",
        Size = UDim2.new(1, -15, 0, 14),
        Position = UDim2.new(0, 10, 0, 44),
        BackgroundTransparency = 1,
        TextColor3 = Theme.SubText,
        Font = Enum.Font.Gotham,
        TextSize = 10,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = LicenseCard
    })
    
    -- Method to update license status
    function Window:SetLicenseStatus(paid)
        isPaid = paid
        LicenseLabel.Text = paid and "PAID" or "FREE"
        LicenseLabel.TextColor3 = paid and Color3.fromRGB(100, 255, 130) or Theme.Text
    end
    
    -- Update Stats
    local Stats = game:GetService("Stats")
    local sessionStart = os.time()
    
    RunService.RenderStepped:Connect(function(dt)
        FPSLabel.Text = math.floor(1/dt)
    end)
    
    -- Update ping and session time every 0.5 seconds
    task.spawn(function()
        while ScreenGui and ScreenGui.Parent do
            local ping = Stats.Network.ServerStatsItem["Data Ping"]:GetValue()
            PingLabel.Text = math.floor(ping) .. " ms"
            
            -- Session time
            local elapsed = os.time() - sessionStart
            local mins = math.floor(elapsed / 60)
            local secs = elapsed % 60
            PlayTimeLabel.Text = string.format("%d:%02d", mins, secs)
            
            task.wait(0.5)
        end
    end)
    
    --// Interaction
    
    -- Intro Animation
    local function Open()
        ScreenGui.Enabled = true
        Scale.Scale = 0.9
        Main.BackgroundTransparency = 0.1
        Utility:Tween(Scale, TweenInfo.new(0.35, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Scale = 1})
        Utility:Tween(Main, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {BackgroundTransparency = 0.02})
    end
    
    local function Close()
        local closeTween = Utility:Tween(Scale, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {Scale = 0.9})
        Utility:Tween(Main, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {BackgroundTransparency = 0.5})
        closeTween.Completed:Connect(function()
            ScreenGui.Enabled = false
        end)
    end
    
    -- Dragging (supports both mouse and touch for mobile)
    local dragging, dragInput, dragStart, startPos
    local blockDrag = false -- Flag to block window drag when using sliders/other elements
    Window._blockDrag = function(val) blockDrag = val end
    
    local function updateDrag(input)
        local delta = input.Position - dragStart
        Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    
    -- Only allow dragging from the sidebar area
    Sidebar.InputBegan:Connect(function(input)
        -- Support both mouse and touch for mobile
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and not blockDrag then
            dragging = true
            dragStart = input.Position
            startPos = Main.Position
            dragInput = input
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    Sidebar.InputChanged:Connect(function(input)
        -- Support both mouse and touch
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            if dragging then
                dragInput = input
            end
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        -- Support both mouse and touch movement
        if dragging and not blockDrag then
            if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
                updateDrag(input)
            end
        end
    end)
    
    --// Tab System
    local currentTab = nil
    local isAnimating = false
    
    -- Track home button elements for SelectTab
    local homeElements = {}
    
    function Window:SelectTab(tabId)
        if isAnimating then return end
        isAnimating = true
        
        -- Reset ALL tabs visually (clear previous selection completely)
        for _, t in pairs(Window.Tabs) do
            Utility:Tween(t.Btn, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {BackgroundColor3 = Theme.Sidebar, BackgroundTransparency = 1})
            Utility:Tween(t.Title, TweenInfo.new(0.2), {TextColor3 = Theme.SubText})
            Utility:Tween(t.Indicator, TweenInfo.new(0.15), {BackgroundTransparency = 1, Size = UDim2.new(0, 3, 0, 0)})
            if t.Icon then Utility:Tween(t.Icon, TweenInfo.new(0.2), {ImageColor3 = Theme.SubText}) end
        end
        
        -- Reset home button visually
        if homeElements.Btn then
            Utility:Tween(homeElements.Btn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Sidebar, BackgroundTransparency = 1})
        end
        if homeElements.Indicator then
            Utility:Tween(homeElements.Indicator, TweenInfo.new(0.15), {BackgroundTransparency = 1, Size = UDim2.new(0, 3, 0, 0)})
        end
        if homeElements.Title then
            Utility:Tween(homeElements.Title, TweenInfo.new(0.2), {TextColor3 = Theme.SubText})
        end
        if homeElements.Icon then
            Utility:Tween(homeElements.Icon, TweenInfo.new(0.2), {ImageColor3 = Theme.SubText})
        end
        
        -- Hide all pages
        HomePage.Visible = false
        for _, t in pairs(Window.Tabs) do
            t.Page.Visible = false
        end
        
        -- Show Home if nil
        if not tabId then
            HomePage.Visible = true
            currentTab = nil
            
            -- Highlight home button
            if homeElements.Btn then
                Utility:Tween(homeElements.Btn, TweenInfo.new(0.25), {BackgroundColor3 = Theme.Section, BackgroundTransparency = 0.5})
            end
            if homeElements.Indicator then
                Utility:Tween(homeElements.Indicator, TweenInfo.new(0.25, Enum.EasingStyle.Back), {BackgroundTransparency = 0, Size = UDim2.new(0, 3, 0, 18)})
            end
            if homeElements.Title then
                Utility:Tween(homeElements.Title, TweenInfo.new(0.2), {TextColor3 = Theme.Accent})
            end
            if homeElements.Icon then
                Utility:Tween(homeElements.Icon, TweenInfo.new(0.2), {ImageColor3 = Theme.Accent})
            end
            
            isAnimating = false
            return
        end
        
        -- Show Tab
        local t = Window.Tabs[tabId]
        if t then
            t.Page.Visible = true
            currentTab = t
            
            -- Animate tab button (highlight selected)
            Utility:Tween(t.Btn, TweenInfo.new(0.25, Enum.EasingStyle.Quad), {BackgroundColor3 = Theme.Section, BackgroundTransparency = 0.5})
            Utility:Tween(t.Title, TweenInfo.new(0.2), {TextColor3 = Theme.Accent})
            Utility:Tween(t.Indicator, TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {BackgroundTransparency = 0, Size = UDim2.new(0, 3, 0, 18)})
            if t.Icon then Utility:Tween(t.Icon, TweenInfo.new(0.2), {ImageColor3 = Theme.Accent}) end
        end
        
        isAnimating = false
    end
    
    -- Toggle Button for PC/Console (keyboard and gamepad support)
    UserInputService.InputBegan:Connect(function(input, processed)
        if not processed then
            -- Support both keyboard and gamepad keycodes
            if input.UserInputType == Enum.UserInputType.Keyboard or input.UserInputType == Enum.UserInputType.Gamepad1 then
                if input.KeyCode == Window._toggleKey then
                    if ScreenGui.Enabled then Close() else Open() end
                end
            end
        end
    end)
    
    --// Public Config Methods
    function Window:SetToggleKey(keyCode)
        Window._toggleKey = keyCode
    end
    
    function Window:SaveConfig(name)
        return saveConfig(name, Window._configValues)
    end
    
    function Window:LoadConfig(name)
        local data = loadConfig(name)
        if data then
            for key, val in pairs(data) do
                Window._configValues[key] = val
                if Window._configCallbacks[key] then
                    pcall(Window._configCallbacks[key], val)
                end
            end
            return true
        end
        return false
    end
    
    function Window:DeleteConfig(name)
        return deleteConfig(name)
    end
    
    function Window:GetConfigs()
        return listConfigs()
    end
    
    function Window:SetAutoLoad(name)
        return setAutoLoadConfig(name)
    end
    
    function Window:GetAutoLoad()
        return getAutoLoadConfig()
    end
    
    function Window:ClearAutoLoad()
        return clearAutoLoadConfig()
    end
    
    -- Add Home Button to Sidebar (responsive for mobile)
    local HomeBtn = Utility:Create("TextButton", {
        Name = "Home",
        Size = UDim2.new(1, 0, 0, IS_MOBILE and 32 or 36),
        BackgroundColor3 = Theme.Sidebar,
        BackgroundTransparency = 1,
        Text = "",
        Parent = NavScroll,
        LayoutOrder = 0,
        ClipsDescendants = true
    })
    Utility:Corner(HomeBtn, IS_MOBILE and 4 or 6)
    
    local HomeIndicator = Utility:Create("Frame", {
        Size = UDim2.new(0, 3, 0, IS_MOBILE and 14 or 18),
        Position = UDim2.new(0, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        BackgroundColor3 = Theme.Accent,
        BackgroundTransparency = 0,
        Parent = HomeBtn
    })
    Utility:Corner(HomeIndicator, 2)
    
    local HomeIcon = Utility:Create("ImageLabel", {
        Size = IS_MOBILE and UDim2.new(0, 14, 0, 14) or UDim2.new(0, 18, 0, 18),
        Position = IS_MOBILE and UDim2.new(0, 8, 0.5, -7) or UDim2.new(0, 12, 0.5, -9),
        BackgroundTransparency = 1,
        Image = "rbxassetid://0", -- Home icon
        ImageColor3 = Theme.Accent,
        Parent = HomeBtn
    })
    
    local HomeTitle = Utility:Create("TextLabel", {
        Text = "Dashboard",
        Size = IS_MOBILE and UDim2.new(1, -30, 1, 0) or UDim2.new(1, -44, 1, 0),
        Position = IS_MOBILE and UDim2.new(0, 28, 0, 0) or UDim2.new(0, 44, 0, 0),
        BackgroundTransparency = 1,
        TextColor3 = Theme.Accent,
        Font = Enum.Font.GothamMedium,
        TextSize = IS_MOBILE and 11 or 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = HomeBtn
    })
    
    HomeBtn.MouseEnter:Connect(function()
        if not currentTab then return end
        Utility:Tween(HomeBtn, TweenInfo.new(0.2), {BackgroundTransparency = 0.7, BackgroundColor3 = Theme.Section})
        Utility:Tween(HomeTitle, TweenInfo.new(0.2), {TextColor3 = Theme.Text})
        Utility:Tween(HomeIcon, TweenInfo.new(0.2), {ImageColor3 = Theme.Text})
    end)
    
    HomeBtn.MouseLeave:Connect(function()
        if not currentTab then return end
        Utility:Tween(HomeBtn, TweenInfo.new(0.2), {BackgroundTransparency = 1, BackgroundColor3 = Theme.Sidebar})
        Utility:Tween(HomeTitle, TweenInfo.new(0.2), {TextColor3 = Theme.SubText})
        Utility:Tween(HomeIcon, TweenInfo.new(0.2), {ImageColor3 = Theme.SubText})
    end)
    
    HomeBtn.MouseButton1Down:Connect(function()
        Utility:Tween(HomeBtn, TweenInfo.new(0.1), {BackgroundTransparency = 0.3})
    end)
    
    HomeBtn.MouseButton1Up:Connect(function()
        Utility:Tween(HomeBtn, TweenInfo.new(0.15), {BackgroundTransparency = 0.5})
    end)
    
    HomeBtn.MouseButton1Click:Connect(function()
        Window:SelectTab(nil)
        Utility:Ripple(HomeBtn, Theme.Accent)
        
        -- Highlight home button
        Utility:Tween(HomeTitle, TweenInfo.new(0.25), {TextColor3 = Theme.Accent})
        Utility:Tween(HomeIcon, TweenInfo.new(0.25), {ImageColor3 = Theme.Accent})
        Utility:Tween(HomeIndicator, TweenInfo.new(0.3, Enum.EasingStyle.Back), {BackgroundTransparency = 0})
    end)
    
    -- Store home button elements for SelectTab to reference
    homeElements.Btn = HomeBtn
    homeElements.Indicator = HomeIndicator
    homeElements.Title = HomeTitle
    homeElements.Icon = HomeIcon
    
    --// Public Methods
    
    function Window:AddTab(name, icon)
        local Tab = {}
        
        -- Tab Button (smaller on mobile)
        local Btn = Utility:Create("TextButton", {
            Name = name,
            Size = UDim2.new(1, 0, 0, IS_MOBILE and 32 or 36),
            BackgroundColor3 = Theme.Sidebar,
            BackgroundTransparency = 1,
            AutoButtonColor = false,
            Text = "",
            Parent = NavScroll,
            LayoutOrder = #Window.Tabs + 1,
            ClipsDescendants = true
        })
        Utility:Corner(Btn, IS_MOBILE and 4 or 6)
        
        local Indicator = Utility:Create("Frame", {
            Size = UDim2.new(0, 3, 0, 0),
            Position = UDim2.new(0, 0, 0.5, 0),
            AnchorPoint = Vector2.new(0, 0.5),
            BackgroundColor3 = Theme.Accent,
            BackgroundTransparency = 1,
            Parent = Btn
        })
        Utility:Corner(Indicator, 2)
        
        local IconLbl = nil
        if icon then
            IconLbl = Utility:Create("ImageLabel", {
                Size = IS_MOBILE and UDim2.new(0, 14, 0, 14) or UDim2.new(0, 18, 0, 18),
                Position = IS_MOBILE and UDim2.new(0, 8, 0.5, -7) or UDim2.new(0, 12, 0.5, -9),
                BackgroundTransparency = 1,
                Image = icon,
                ImageColor3 = Theme.SubText,
                Parent = Btn
            })
        end
        
        local Title = Utility:Create("TextLabel", {
            Text = name,
            Size = IS_MOBILE and UDim2.new(1, -30, 1, 0) or UDim2.new(1, -44, 1, 0),
            Position = IS_MOBILE and UDim2.new(0, 28, 0, 0) or UDim2.new(0, 44, 0, 0),
            BackgroundTransparency = 1,
            TextColor3 = Theme.SubText,
            Font = Enum.Font.GothamMedium,
            TextSize = IS_MOBILE and 11 or 13,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextTruncate = Enum.TextTruncate.AtEnd,
            Parent = Btn
        })
        
        -- Hover effects
        Btn.MouseEnter:Connect(function()
            if currentTab and currentTab.Btn == Btn then return end
            Utility:Tween(Btn, TweenInfo.new(0.2), {BackgroundTransparency = 0.7, BackgroundColor3 = Theme.Section})
            Utility:Tween(Title, TweenInfo.new(0.2), {TextColor3 = Theme.Text})
            if IconLbl then Utility:Tween(IconLbl, TweenInfo.new(0.2), {ImageColor3 = Theme.Text}) end
        end)
        
        Btn.MouseLeave:Connect(function()
            if currentTab and currentTab.Btn == Btn then return end
            Utility:Tween(Btn, TweenInfo.new(0.2), {BackgroundTransparency = 1, BackgroundColor3 = Theme.Sidebar})
            Utility:Tween(Title, TweenInfo.new(0.2), {TextColor3 = Theme.SubText})
            if IconLbl then Utility:Tween(IconLbl, TweenInfo.new(0.2), {ImageColor3 = Theme.SubText}) end
        end)
        
        -- Page
        local Page = Utility:Create("ScrollingFrame", {
        Name = name,
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            ScrollBarThickness = 2,
            ScrollBarImageColor3 = Theme.Accent,
            Visible = false,
            Parent = Pages,
            AutomaticCanvasSize = Enum.AutomaticSize.Y,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            ScrollingDirection = Enum.ScrollingDirection.Y,
            ElasticBehavior = Enum.ElasticBehavior.Never
        })
        local PageLayout = Utility:Create("UIListLayout", {
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 10),
            Parent = Page
        })
        Utility:Create("UIPadding", {
            PaddingTop = UDim.new(0, 15),
            PaddingLeft = UDim.new(0, 15),
            PaddingRight = UDim.new(0, 15),
            PaddingBottom = UDim.new(0, 15),
            Parent = Page
        })
        
        -- Button Logic with press animation
        Btn.MouseButton1Down:Connect(function()
            Utility:Tween(Btn, TweenInfo.new(0.1), {BackgroundTransparency = 0.3})
        end)
        
        Btn.MouseButton1Up:Connect(function()
            Utility:Tween(Btn, TweenInfo.new(0.15), {BackgroundTransparency = 0.5})
        end)
        
        Btn.MouseButton1Click:Connect(function()
            Window:SelectTab(name)
            Utility:Ripple(Btn, Theme.Accent)
        end)
        
        -- Store tab data
        local TabObj = {Btn = Btn, Page = Page, Indicator = Indicator, Title = Title, Icon = IconLbl}
        Window.Tabs[name] = TabObj
        
        -- Layout: Two-column on desktop, single-column on mobile
        local ColumnsContainer = Utility:Create("Frame", {
            Name = "ColumnsContainer",
            Size = UDim2.new(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundTransparency = 1,
            Parent = Page
        })
        
        -- Left column (full width on mobile)
        local LeftColumn = Utility:Create("Frame", {
            Name = "LeftColumn",
            Size = IS_MOBILE and UDim2.new(1, 0, 0, 0) or UDim2.new(0.5, -6, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            Position = UDim2.new(0, 0, 0, 0),
            BackgroundTransparency = 1,
            Parent = ColumnsContainer
        })
        Utility:Create("UIListLayout", {
            Padding = UDim.new(0, IS_MOBILE and 8 or 12),
            SortOrder = Enum.SortOrder.LayoutOrder,
            Parent = LeftColumn
        })
        
        -- Right column (hidden on mobile, sections go to left column instead)
        local RightColumn = Utility:Create("Frame", {
            Name = "RightColumn",
            Size = IS_MOBILE and UDim2.new(1, 0, 0, 0) or UDim2.new(0.5, -6, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            Position = IS_MOBILE and UDim2.new(0, 0, 0, 0) or UDim2.new(0.5, 6, 0, 0),
            BackgroundTransparency = 1,
            Visible = not IS_MOBILE, -- Hidden on mobile
            Parent = ColumnsContainer
        })
        Utility:Create("UIListLayout", {
            Padding = UDim.new(0, IS_MOBILE and 8 or 12),
            SortOrder = Enum.SortOrder.LayoutOrder,
            Parent = RightColumn
        })
        
        -- Track which column to add next section to
        local sectionCount = 0
        
        -- Update container height based on tallest column
        local function updateContainerHeight()
            task.defer(function()
                local leftHeight = LeftColumn.AbsoluteSize.Y
                local rightHeight = IS_MOBILE and 0 or RightColumn.AbsoluteSize.Y
                ColumnsContainer.Size = UDim2.new(1, 0, 0, math.max(leftHeight, rightHeight))
            end)
        end
        
        -- Tab Methods
        function Tab:AddSection(title)
            local Section = {}
            
            -- On mobile: all sections go to left column (single column layout)
            -- On desktop: alternate between left and right columns
            sectionCount = sectionCount + 1
            local targetColumn = IS_MOBILE and LeftColumn or ((sectionCount % 2 == 1) and LeftColumn or RightColumn)
            
            -- Section box (full width of column)
            local Container = Utility:Create("Frame", {
                Name = "Section_" .. title,
                Size = UDim2.new(1, 0, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = Theme.Section,
                LayoutOrder = math.ceil(sectionCount / 2),
                Parent = targetColumn
            })
            Utility:Corner(Container, 8)
            Utility:Stroke(Container, Theme.Outline, 1)
            
            -- Update parent container height when section changes
            Container:GetPropertyChangedSignal("AbsoluteSize"):Connect(updateContainerHeight)
            updateContainerHeight()
            
            -- Header
            local Header = Utility:Create("TextLabel", {
                Text = title,
                Size = UDim2.new(1, 0, 0, 28),
                BackgroundTransparency = 1,
                TextColor3 = Theme.SubText,
                Font = Enum.Font.GothamBold,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = Container
            })
            Utility:Create("UIPadding", {
                PaddingLeft = UDim.new(0, 12),
                Parent = Header
            })
            
            local ItemsDiv = Utility:Create("Frame", {
                Size = UDim2.new(1, 0, 0, 0),
                Position = UDim2.new(0, 0, 0, 28),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundTransparency = 1,
                Parent = Container
            })
            local ItemsLayout = Utility:Create("UIListLayout", {
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 6),
                Parent = ItemsDiv
            })
            Utility:Create("UIPadding", {
                PaddingLeft = UDim.new(0, 10),
                PaddingRight = UDim.new(0, 10),
                PaddingBottom = UDim.new(0, 10),
                Parent = ItemsDiv
            })
            
            -- Widgets
            
            function Section:AddButton(opts)
                local bName = opts.Name or "Button"
                local callback = opts.Callback or function() end
                
                local BtnFrame = Utility:Create("TextButton", {
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundColor3 = Theme.Element,
                    Text = "",
                    AutoButtonColor = false,
                    Parent = ItemsDiv,
                    ClipsDescendants = true
                })
                Utility:Corner(BtnFrame, 6)
                local S = Utility:Stroke(BtnFrame, Theme.Outline, 1)
                
                local Lbl = Utility:Create("TextLabel", {
                    Text = bName,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 13,
                    Parent = BtnFrame
                })
                
                BtnFrame.MouseEnter:Connect(function()
                    Utility:Tween(BtnFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 50)})
                    Utility:Tween(S, TweenInfo.new(0.2), {Color = Color3.fromRGB(80, 80, 80)})
                end)
                BtnFrame.MouseLeave:Connect(function()
                    Utility:Tween(BtnFrame, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Element})
                    Utility:Tween(S, TweenInfo.new(0.2), {Color = Theme.Outline})
                end)
                
                BtnFrame.MouseButton1Down:Connect(function()
                    Utility:Tween(BtnFrame, TweenInfo.new(0.08), {Size = UDim2.new(1, -4, 0, 30)})
                end)
                
                BtnFrame.MouseButton1Up:Connect(function()
                    Utility:Tween(BtnFrame, TweenInfo.new(0.15, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(1, 0, 0, 32)})
                end)
                
                BtnFrame.MouseButton1Click:Connect(function()
                    Utility:Ripple(BtnFrame)
                    Utility:ParticleEffect(BtnFrame)
                    callback()
                end)
                
                -- Register for search
                table.insert(Window.Elements, {Type = "Button", Name = bName, Obj = BtnFrame, Section = title, Tab = name, Container = Container})
                return {
                    Frame = BtnFrame,
                    SetVisible = function(_, visible) BtnFrame.Visible = visible end
                }
            end
            
            function Section:AddToggle(opts)
                local tName = opts.Name or "Toggle"
                local configKey = opts.ConfigKey or tName
    local state = opts.Default or false
                local callback = opts.Callback or function() end
                
                local Frame = Utility:Create("TextButton", {
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundTransparency = 1,
                    Text = "",
                    Parent = ItemsDiv
                })
                
                local Label = Utility:Create("TextLabel", {
                    Text = tName,
                    Size = UDim2.new(1, -50, 1, 0),
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = Frame
                })
                
                local Switch = Utility:Create("Frame", {
                    Size = UDim2.new(0, 40, 0, 20),
                    Position = UDim2.new(1, -40, 0.5, -10),
                    BackgroundColor3 = Theme.Element,
                    Parent = Frame
                })
                Utility:Corner(Switch, 10)
                Utility:Stroke(Switch, Theme.Outline, 1)
                
                local Knob = Utility:Create("Frame", {
                    Size = UDim2.new(0, 16, 0, 16),
                    Position = UDim2.new(0, 2, 0.5, -8),
                    BackgroundColor3 = Theme.SubText,
                    Parent = Switch
                })
                Utility:Corner(Knob, 8)
                
                local function Update()
        if state then
                        Utility:Tween(Switch, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(70, 70, 70)})
                        Utility:Tween(Knob, TweenInfo.new(0.2), {Position = UDim2.new(1, -18, 0.5, -8), BackgroundColor3 = Color3.new(1,1,1)})
        else
                        Utility:Tween(Switch, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Element})
                        Utility:Tween(Knob, TweenInfo.new(0.2), {Position = UDim2.new(0, 2, 0.5, -8), BackgroundColor3 = Theme.SubText})
        end
    end
    
    local function setState(val, skipCallback)
        state = val
                    Update()
                    Window._configValues[configKey] = state
                    if not skipCallback and callback then
                        callback(state)
        end
    end
    
                Frame.MouseButton1Down:Connect(function()
                    Utility:Tween(Knob, TweenInfo.new(0.1), {Size = UDim2.new(0, 14, 0, 14)})
                end)
                
                Frame.MouseButton1Up:Connect(function()
                    Utility:Tween(Knob, TweenInfo.new(0.15, Enum.EasingStyle.Back), {Size = UDim2.new(0, 16, 0, 16)})
                end)
                
                Frame.MouseButton1Click:Connect(function()
                    local newState = not state
                    setState(newState)
                    if newState then
                        Utility:ParticleEffect(Switch, Theme.Accent)
                    end
                end)
                
                -- Register config callback (triggers actual callback so feature activates on config load)
                Window._configCallbacks[configKey] = function(val)
                    setState(val, false) -- false = DO trigger callback so feature activates
                end
                Window._configValues[configKey] = state
                Update()
                
                table.insert(Window.Elements, {Type = "Toggle", Name = tName, Obj = Frame, Section = title, Tab = name, Container = Container})
    return {
                    Set = function(_, s) setState(s) end,
                    Get = function() return state end,
                    SetVisible = function(_, visible) Frame.Visible = visible end
    }
end

            function Section:AddSlider(opts)
                local sName = opts.Name or "Slider"
                local configKey = opts.ConfigKey or sName
    local min = opts.Min or 0
    local max = opts.Max or 100
                local def = opts.Default or min
                local increment = opts.Increment or 1
                local callback = opts.Callback or function() end
                
                -- Calculate decimal places from increment
                local decimalPlaces = 0
                local incStr = tostring(increment)
                if incStr:find("%.") then
                    decimalPlaces = #incStr - incStr:find("%.")
                end
                
                local function formatValue(val)
                    if decimalPlaces > 0 then
                        return string.format("%." .. decimalPlaces .. "f", val)
                    else
                        return tostring(math.floor(val))
                    end
                end
                
                local function roundToIncrement(val)
                    return math.floor(val / increment + 0.5) * increment
                end
                
                local Frame = Utility:Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 46),
                    BackgroundTransparency = 1,
                    Parent = ItemsDiv
                })
                
                local Label = Utility:Create("TextLabel", {
                    Text = sName,
                    Size = UDim2.new(1, -55, 0, 20),
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = Frame
                })
                
                -- Clickable value input
                local ValueBox = Utility:Create("TextBox", {
                    Text = formatValue(def),
                    Size = UDim2.new(0, 50, 0, 20),
                    Position = UDim2.new(1, -50, 0, 0),
                    BackgroundColor3 = Theme.Element,
                    BackgroundTransparency = 0.5,
                    TextColor3 = Theme.Accent,
                    Font = Enum.Font.GothamBold,
                    TextSize = 12,
                    TextXAlignment = Enum.TextXAlignment.Center,
                    ClearTextOnFocus = true,
                    Parent = Frame
                })
                Utility:Corner(ValueBox, 4)
                
                -- Track (larger hit area for mobile)
                local TrackContainer = Utility:Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 20),
                    Position = UDim2.new(0, 0, 0, 24),
                    BackgroundTransparency = 1,
                    Parent = Frame
                })
                
                local Track = Utility:Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 8),
                    Position = UDim2.new(0, 0, 0.5, -4),
                    BackgroundColor3 = Theme.Element,
                    Parent = TrackContainer
                })
                Utility:Corner(Track, 4)
                Utility:Stroke(Track, Theme.Outline, 1)
                
                local Fill = Utility:Create("Frame", {
                    Size = UDim2.new(0, 0, 1, 0),
                    BackgroundColor3 = Theme.Accent,
                    Parent = Track,
                    ClipsDescendants = true
                })
                Utility:Corner(Fill, 4)
                
                local sliderDragging = false
                local currentValue = def
    
    local function setValue(val, skipCallback)
                    val = math.clamp(roundToIncrement(val), min, max)
                    currentValue = val
                    local pos = (val - min) / (max - min)
                    ValueBox.Text = formatValue(val)
                    Utility:Tween(Fill, TweenInfo.new(0.1, Enum.EasingStyle.Quad), {Size = UDim2.new(pos, 0, 1, 0)})
                    Window._configValues[configKey] = val
                    if not skipCallback and callback then
                        callback(val)
                    end
                end
                
                local function UpdateSlider(inputX)
                    local x = math.clamp((inputX - Track.AbsolutePosition.X) / Track.AbsoluteSize.X, 0, 1)
                    local rawVal = min + ((max - min) * x)
                    setValue(rawVal)
                end
                
                -- Value box input handling
                ValueBox.Focused:Connect(function()
                    Utility:Tween(ValueBox, TweenInfo.new(0.15), {BackgroundTransparency = 0, BackgroundColor3 = Theme.Section})
                end)
                
                ValueBox.FocusLost:Connect(function(enterPressed)
                    Utility:Tween(ValueBox, TweenInfo.new(0.15), {BackgroundTransparency = 0.5, BackgroundColor3 = Theme.Element})
                    local num = tonumber(ValueBox.Text)
                    if num then
                        setValue(num)
                    else
                        ValueBox.Text = formatValue(currentValue)
                    end
                end)
                
                -- Visual feedback on interaction
                local function onSliderStart()
                    Utility:Tween(Track, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 10), Position = UDim2.new(0, 0, 0.5, -5)})
                end
                
                local function onSliderEnd()
                    Utility:Tween(Track, TweenInfo.new(0.2, Enum.EasingStyle.Back), {Size = UDim2.new(1, 0, 0, 8), Position = UDim2.new(0, 0, 0.5, -4)})
                end
                
                TrackContainer.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                        sliderDragging = true
                        Window._blockDrag(true)
                        onSliderStart()
                        UpdateSlider(input.Position.X)
        end
    end)
    
                TrackContainer.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                        sliderDragging = false
                        Window._blockDrag(false)
                        onSliderEnd()
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
                    if sliderDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                        UpdateSlider(input.Position.X)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
                    if sliderDragging and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
                        sliderDragging = false
                        Window._blockDrag(false)
                        onSliderEnd()
        end
    end)
    
                -- Init
                local startPercent = (def - min) / (max - min)
                Fill.Size = UDim2.new(startPercent, 0, 1, 0)
                
                -- Register config callback (triggers actual callback so feature activates on config load)
                Window._configCallbacks[configKey] = function(val)
                    setValue(val, false) -- false = DO trigger callback so feature activates
                end
                Window._configValues[configKey] = currentValue
                
                table.insert(Window.Elements, {Type = "Slider", Name = sName, Obj = Frame, Section = title, Tab = name, Container = Container})
    return {
                    Frame = Frame,
        Set = function(_, val) setValue(val) end,
                    Get = function() return currentValue end,
                    SetVisible = function(_, visible) Frame.Visible = visible end
                }
            end
            
            function Section:AddDropdown(opts)
                local dName = opts.Name or "Dropdown"
                local configKey = opts.ConfigKey or dName
                local options = opts.Options or {}
                local callback = opts.Callback or function() end
                
                local open = false
                local current = opts.Default or options[1] or "None"
                
                local Frame = Utility:Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundTransparency = 1,
                    Parent = ItemsDiv,
                    ZIndex = 5
                })
                
                local MainBtn = Utility:Create("TextButton", {
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundColor3 = Theme.Element,
                    Text = "",
                    AutoButtonColor = false,
                    Parent = Frame,
                    ClipsDescendants = true
                })
                Utility:Corner(MainBtn, 6)
                Utility:Stroke(MainBtn, Theme.Outline, 1)
                
                local Label = Utility:Create("TextLabel", {
                    Text = dName .. ": " .. current,
                    Size = UDim2.new(1, -30, 1, 0),
                    Position = UDim2.new(0, 10, 0, 0),
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = MainBtn
                })
                
                local Arrow = Utility:Create("ImageLabel", {
                    Size = UDim2.new(0, 16, 0, 16),
                    Position = UDim2.new(1, -24, 0.5, -8),
                    BackgroundTransparency = 1,
                    Image = "rbxassetid://6031091004",
                    ImageColor3 = Theme.SubText,
                    Parent = MainBtn
                })
                
                local List = Utility:Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 0),
                    Position = UDim2.new(0, 0, 0, 37),
                    BackgroundColor3 = Theme.Element,
                    Parent = Frame,
                    Visible = false,
                    ClipsDescendants = true,
                    ZIndex = 50
                })
                Utility:Corner(List, 6)
                Utility:Stroke(List, Theme.Outline, 1)
                
                local ListLayout = Utility:Create("UIListLayout", {
                    SortOrder = Enum.SortOrder.LayoutOrder,
                    Parent = List
                })
                
                for _, opt in ipairs(options) do
                    local Item = Utility:Create("TextButton", {
                        Size = UDim2.new(1, 0, 0, 26),
                        BackgroundColor3 = Theme.Element,
                        BackgroundTransparency = 1,
                        Text = opt,
                        TextColor3 = Theme.SubText,
                        Font = Enum.Font.Gotham,
                        TextSize = 12,
                        Parent = List,
                        ZIndex = 51
                    })
                    Item.MouseEnter:Connect(function()
                        Item.TextColor3 = Theme.Text
                        Utility:Tween(Item, TweenInfo.new(0.15), {BackgroundTransparency = 0.5})
                    end)
                    Item.MouseLeave:Connect(function()
                        Item.TextColor3 = Theme.SubText
                        Utility:Tween(Item, TweenInfo.new(0.15), {BackgroundTransparency = 1})
                    end)
                    Item.MouseButton1Click:Connect(function()
                        current = opt
                        Label.Text = dName .. ": " .. current
                        Window._configValues[configKey] = current
                        callback(opt)
                        -- Close
                        open = false
                        Utility:Tween(List, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 0)})
                        task.delay(0.15, function()
                            List.Visible = false
                        end)
                        Utility:Tween(Frame, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 32)})
                        Utility:Tween(Arrow, TweenInfo.new(0.15), {Rotation = 0})
                    end)
                end
    
                MainBtn.MouseEnter:Connect(function()
                    Utility:Tween(MainBtn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Section})
                end)
                
                MainBtn.MouseLeave:Connect(function()
                    Utility:Tween(MainBtn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Element})
                end)
                
                MainBtn.MouseButton1Down:Connect(function()
                    Utility:Tween(MainBtn, TweenInfo.new(0.1), {BackgroundTransparency = 0.3})
                end)
                
                MainBtn.MouseButton1Up:Connect(function()
                    Utility:Tween(MainBtn, TweenInfo.new(0.15), {BackgroundTransparency = 0})
                end)
                
                MainBtn.MouseButton1Click:Connect(function()
                    open = not open
                    Utility:Ripple(MainBtn, Theme.Accent)
                    if open then
                        local h = #options * 26
                        -- First expand the frame, then show list
                        List.Size = UDim2.new(1, 0, 0, 0)
                        List.Visible = true
                        Utility:Tween(Frame, TweenInfo.new(0.2, Enum.EasingStyle.Quart), {Size = UDim2.new(1, 0, 0, 32 + h + 5)})
                        Utility:Tween(List, TweenInfo.new(0.2, Enum.EasingStyle.Quart), {Size = UDim2.new(1, 0, 0, h)})
                        Utility:Tween(Arrow, TweenInfo.new(0.2), {Rotation = 180})
                    else
                        -- Collapse list first, then hide
                        Utility:Tween(List, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 0)})
                        Utility:Tween(Frame, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 32)})
                        Utility:Tween(Arrow, TweenInfo.new(0.15), {Rotation = 0})
                        task.delay(0.15, function()
                            if not open then
                                List.Visible = false
                            end
                        end)
                    end
                end)
                
                -- Register config callback (triggers actual callback so feature activates on config load)
                Window._configCallbacks[configKey] = function(val)
                    current = val
                    Label.Text = dName .. ": " .. val
                    Window._configValues[configKey] = current
                    callback(val) -- Trigger callback so feature activates
                end
                if current then
                    Window._configValues[configKey] = current
                end
                
                table.insert(Window.Elements, {Type = "Dropdown", Name = dName, Obj = Frame, Section = title, Tab = name, Container = Container})
                
                local function createOption(opt)
                    local Item = Utility:Create("TextButton", {
                        Size = UDim2.new(1, 0, 0, 26),
                        BackgroundColor3 = Theme.Element,
                        BackgroundTransparency = 1,
                        Text = opt,
                        TextColor3 = Theme.SubText,
                        Font = Enum.Font.Gotham,
                        TextSize = 12,
                        Parent = List,
                        ZIndex = 51
                    })
                    Item.MouseEnter:Connect(function()
                        Item.TextColor3 = Theme.Text
                        Utility:Tween(Item, TweenInfo.new(0.15), {BackgroundTransparency = 0.5})
                    end)
                    Item.MouseLeave:Connect(function()
                        Item.TextColor3 = Theme.SubText
                        Utility:Tween(Item, TweenInfo.new(0.15), {BackgroundTransparency = 1})
                    end)
                    Item.MouseButton1Click:Connect(function()
                        current = opt
                        Label.Text = dName .. ": " .. current
                        Window._configValues[configKey] = current
                        callback(opt)
                        open = false
                        Utility:Tween(List, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 0)})
                        task.delay(0.15, function() List.Visible = false end)
                        Utility:Tween(Frame, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 32)})
                        Utility:Tween(Arrow, TweenInfo.new(0.15), {Rotation = 0})
                    end)
                end
    
    return {
                    Frame = Frame,
                    Set = function(_, val)
                        current = val
                        Label.Text = dName .. ": " .. val
                        Window._configValues[configKey] = current
                    end,
                    Get = function() return current end,
                    SetVisible = function(_, visible) Frame.Visible = visible end,
                    Refresh = function(newOptions)
                        -- Clear existing options
                        for _, child in pairs(List:GetChildren()) do
                            if child:IsA("TextButton") then child:Destroy() end
                        end
                        options = newOptions or {}
                        -- Add new options
                        for _, opt in ipairs(options) do
                            createOption(opt)
                        end
                    end
                }
            end
            
            function Section:AddMultiDropdown(opts)
                local dName = opts.Name or "Multi Dropdown"
                local configKey = opts.ConfigKey or dName
                local options = opts.Options or {}
                local callback = opts.Callback or function() end
                local defaultSelected = opts.Default or {}
                
                local open = false
                local selected = {}
                
                -- Initialize selected from default
                for _, v in ipairs(defaultSelected) do
                    selected[v] = true
                end
                
                local function getSelectedText()
                    local items = {}
                    for _, opt in ipairs(options) do
                        if selected[opt] then
                            table.insert(items, opt)
                        end
                    end
                    if #items == 0 then
                        return "None"
                    elseif #items <= 2 then
                        return table.concat(items, ", ")
                    else
                        return items[1] .. ", " .. items[2] .. " +" .. (#items - 2)
                    end
                end
                
                local function getSelectedArray()
                    local items = {}
                    for _, opt in ipairs(options) do
                        if selected[opt] then
                            table.insert(items, opt)
                        end
                    end
                    return items
                end
                
                local Frame = Utility:Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundTransparency = 1,
                    Parent = ItemsDiv,
                    ZIndex = 5
                })
                
                local MainBtn = Utility:Create("TextButton", {
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundColor3 = Theme.Element,
                    Text = "",
                    AutoButtonColor = false,
                    Parent = Frame,
                    ClipsDescendants = true
                })
                Utility:Corner(MainBtn, 6)
                Utility:Stroke(MainBtn, Theme.Outline, 1)
                
                local Label = Utility:Create("TextLabel", {
                    Text = dName .. ": " .. getSelectedText(),
                    Size = UDim2.new(1, -30, 1, 0),
                    Position = UDim2.new(0, 10, 0, 0),
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextTruncate = Enum.TextTruncate.AtEnd,
                    Parent = MainBtn
                })
                
                local Arrow = Utility:Create("ImageLabel", {
                    Size = UDim2.new(0, 16, 0, 16),
                    Position = UDim2.new(1, -24, 0.5, -8),
                    BackgroundTransparency = 1,
                    Image = "rbxassetid://6031091004",
                    ImageColor3 = Theme.SubText,
                    Parent = MainBtn
                })
                
                local List = Utility:Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 0),
                    Position = UDim2.new(0, 0, 0, 37),
                    BackgroundColor3 = Theme.Element,
                    Parent = Frame,
                    Visible = false,
                    ClipsDescendants = true,
                    ZIndex = 50
                })
                Utility:Corner(List, 6)
                Utility:Stroke(List, Theme.Outline, 1)
                
                local ListLayout = Utility:Create("UIListLayout", {
                    SortOrder = Enum.SortOrder.LayoutOrder,
                    Parent = List
                })
                
                local itemRefs = {}
                
                local function updateItem(opt, item, check)
                    if selected[opt] then
                        check.Text = "✓"
                        check.TextColor3 = Color3.fromRGB(100, 255, 130)
                        item.BackgroundTransparency = 0.7
                    else
                        check.Text = ""
                        item.BackgroundTransparency = 1
                    end
                end
                
                -- Function to create an option item
                local function createOption(opt)
                    local Item = Utility:Create("TextButton", {
                        Size = UDim2.new(1, 0, 0, 26),
                        BackgroundColor3 = Theme.Section,
                        BackgroundTransparency = selected[opt] and 0.7 or 1,
                        Text = "",
                        Parent = List,
                        ZIndex = 51
                    })
                    
                    local Check = Utility:Create("TextLabel", {
                        Text = selected[opt] and "✓" or "",
                        Size = UDim2.new(0, 20, 1, 0),
                        Position = UDim2.new(0, 5, 0, 0),
                        BackgroundTransparency = 1,
                        TextColor3 = Color3.fromRGB(100, 255, 130),
                        Font = Enum.Font.GothamBold,
                        TextSize = 14,
                        ZIndex = 52,
                        Parent = Item
                    })
                    
                    local ItemLabel = Utility:Create("TextLabel", {
                        Text = opt,
                        Size = UDim2.new(1, -30, 1, 0),
                        Position = UDim2.new(0, 25, 0, 0),
                        BackgroundTransparency = 1,
                        TextColor3 = Theme.SubText,
                        Font = Enum.Font.Gotham,
                        TextSize = 12,
                        TextXAlignment = Enum.TextXAlignment.Left,
                        ZIndex = 52,
                        Parent = Item
                    })
                    
                    itemRefs[opt] = {Item = Item, Check = Check, Label = ItemLabel}
                    
                    Item.MouseEnter:Connect(function()
                        ItemLabel.TextColor3 = Theme.Text
                        if not selected[opt] then
                            Utility:Tween(Item, TweenInfo.new(0.15), {BackgroundTransparency = 0.8})
                        end
                    end)
                    
                    Item.MouseLeave:Connect(function()
                        ItemLabel.TextColor3 = Theme.SubText
                        if not selected[opt] then
                            Utility:Tween(Item, TweenInfo.new(0.15), {BackgroundTransparency = 1})
                        end
                    end)
                    
                    Item.MouseButton1Click:Connect(function()
                        selected[opt] = not selected[opt]
                        updateItem(opt, Item, Check)
                        Label.Text = dName .. ": " .. getSelectedText()
                        Window._configValues[configKey] = getSelectedArray()
                        callback(getSelectedArray())
                    end)
                end
                
                -- Create initial options
                for _, opt in ipairs(options) do
                    createOption(opt)
                end
                
                MainBtn.MouseEnter:Connect(function()
                    Utility:Tween(MainBtn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Section})
                end)
                
                MainBtn.MouseLeave:Connect(function()
                    Utility:Tween(MainBtn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Element})
                end)
                
                MainBtn.MouseButton1Click:Connect(function()
                    open = not open
                    Utility:Ripple(MainBtn, Theme.Accent)
                    if open then
                        local h = #options * 26
                        List.Size = UDim2.new(1, 0, 0, 0)
                        List.Visible = true
                        Utility:Tween(Frame, TweenInfo.new(0.2, Enum.EasingStyle.Quart), {Size = UDim2.new(1, 0, 0, 32 + h + 5)})
                        Utility:Tween(List, TweenInfo.new(0.2, Enum.EasingStyle.Quart), {Size = UDim2.new(1, 0, 0, h)})
                        Utility:Tween(Arrow, TweenInfo.new(0.2), {Rotation = 180})
                    else
                        Utility:Tween(List, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 0)})
                        Utility:Tween(Frame, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 32)})
                        Utility:Tween(Arrow, TweenInfo.new(0.15), {Rotation = 0})
                        task.delay(0.15, function()
                            if not open then
                                List.Visible = false
                            end
                        end)
                    end
                end)
                
                -- Register config callback (triggers actual callback so feature activates on config load)
                Window._configCallbacks[configKey] = function(val)
                    if type(val) == "table" then
                        selected = {}
                        for _, v in ipairs(val) do
                            selected[v] = true
                        end
                        Label.Text = dName .. ": " .. getSelectedText()
                        Window._configValues[configKey] = getSelectedArray()
                        -- Update visual state
                        for opt, refs in pairs(itemRefs) do
                            updateItem(opt, refs.Item, refs.Check)
                        end
                        callback(getSelectedArray()) -- Trigger callback so feature activates
                    end
                end
                Window._configValues[configKey] = getSelectedArray()
                
                table.insert(Window.Elements, {Type = "MultiDropdown", Name = dName, Obj = Frame, Section = title, Tab = name, Container = Container})
                
                return {
                    Set = function(_, values)
                        selected = {}
                        for _, v in ipairs(values) do
                            selected[v] = true
                        end
                        Label.Text = dName .. ": " .. getSelectedText()
                        Window._configValues[configKey] = getSelectedArray()
                        for opt, refs in pairs(itemRefs) do
                            updateItem(opt, refs.Item, refs.Check)
                        end
                    end,
                    Get = function() return getSelectedArray() end,
                    Add = function(_, opt)
                        selected[opt] = true
                        Label.Text = dName .. ": " .. getSelectedText()
                        Window._configValues[configKey] = getSelectedArray()
                        if itemRefs[opt] then
                            updateItem(opt, itemRefs[opt].Item, itemRefs[opt].Check)
                        end
                        callback(getSelectedArray())
                    end,
                    Remove = function(_, opt)
                        selected[opt] = nil
                        Label.Text = dName .. ": " .. getSelectedText()
                        Window._configValues[configKey] = getSelectedArray()
                        if itemRefs[opt] then
                            updateItem(opt, itemRefs[opt].Item, itemRefs[opt].Check)
                        end
                        callback(getSelectedArray())
                    end,
                    Clear = function(_)
                        selected = {}
                        Label.Text = dName .. ": None"
                        Window._configValues[configKey] = {}
                        for opt, refs in pairs(itemRefs) do
                            updateItem(opt, refs.Item, refs.Check)
                        end
                        callback({})
                    end,
                    SetVisible = function(_, visible) Frame.Visible = visible end,
                    SetOptions = function(_, newOptions, keepSelection)
                        -- Destroy existing option items
                        for opt, refs in pairs(itemRefs) do
                            if refs.Item then
                                refs.Item:Destroy()
                            end
                        end
                        itemRefs = {}
                        
                        -- Update options
                        options = newOptions or {}
                        
                        -- Clear selections that are no longer valid (unless keepSelection is true)
                        if not keepSelection then
                            selected = {}
                        else
                            -- Keep only selections that exist in new options
                            local validOptions = {}
                            for _, opt in ipairs(options) do
                                validOptions[opt] = true
                            end
                            for opt, _ in pairs(selected) do
                                if not validOptions[opt] then
                                    selected[opt] = nil
                                end
                            end
                        end
                        
                        -- Create new option items
                        for _, opt in ipairs(options) do
                            createOption(opt)
                        end
                        
                        -- Update label
                        Label.Text = dName .. ": " .. getSelectedText()
                        Window._configValues[configKey] = getSelectedArray()
                        
                        -- If dropdown is open, update its size
                        if open then
                            local h = #options * 26
                            Utility:Tween(Frame, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 32 + h + 5)})
                            Utility:Tween(List, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, h)})
                        end
                    end
                }
            end
            
            function Section:AddKeybind(opts)
                local kName = opts.Name or "Keybind"
                local configKey = opts.ConfigKey or kName
                local key = opts.Default
                local callback = opts.Callback or function() end
                
                local Frame = Utility:Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundTransparency = 1,
                    Parent = ItemsDiv
                })
                
                local Label = Utility:Create("TextLabel", {
                    Text = kName,
                    Size = UDim2.new(1, -100, 1, 0),
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = Frame
                })
                
                local BindBtn = Utility:Create("TextButton", {
                    Size = UDim2.new(0, 80, 0, 24),
                    Position = UDim2.new(1, -80, 0.5, -12),
                    BackgroundColor3 = Theme.Element,
                    Text = key and key.Name or "None",
                    TextColor3 = Theme.SubText,
                    Font = Enum.Font.GothamBold,
                    TextSize = 12,
                    Parent = Frame,
                    ClipsDescendants = true
                })
                Utility:Corner(BindBtn, 4)
                
                local listening = false
                local BindStroke = Utility:Stroke(BindBtn, Theme.Outline, 1)
                
                local function setKey(k, skipCallback)
                    key = k
                    BindBtn.Text = k and k.Name or "None"
                    Window._configValues[configKey] = k and k.Name or nil
                    if not skipCallback and callback then
                        callback(k)
                    end
                end
                
                BindBtn.MouseEnter:Connect(function()
                    Utility:Tween(BindBtn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Section})
                    Utility:Tween(BindStroke, TweenInfo.new(0.2), {Color = Theme.Accent})
                end)
                
                BindBtn.MouseLeave:Connect(function()
                    if not listening then
                        Utility:Tween(BindBtn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Element})
                        Utility:Tween(BindStroke, TweenInfo.new(0.2), {Color = Theme.Outline})
                    end
                end)
                
                BindBtn.MouseButton1Click:Connect(function()
                    listening = true
                    BindBtn.Text = "..."
                    BindBtn.TextColor3 = Theme.Accent
                    Utility:Tween(BindStroke, TweenInfo.new(0.2), {Color = Theme.Accent})
                    Utility:Ripple(BindBtn, Theme.Accent)
                end)
                
                UserInputService.InputBegan:Connect(function(input, processed)
                    if listening then
                        -- Support keyboard and gamepad
                        if input.UserInputType == Enum.UserInputType.Keyboard then
                            listening = false
                            setKey(input.KeyCode)
                            Utility:Tween(BindBtn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Element})
                            Utility:Tween(BindBtn, TweenInfo.new(0.2), {TextColor3 = Theme.SubText})
                            Utility:Tween(BindStroke, TweenInfo.new(0.2), {Color = Theme.Outline})
                        elseif input.UserInputType == Enum.UserInputType.Gamepad1 then
                            listening = false
                            setKey(input.KeyCode)
                            Utility:Tween(BindBtn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Element})
                            Utility:Tween(BindBtn, TweenInfo.new(0.2), {TextColor3 = Theme.SubText})
                            Utility:Tween(BindStroke, TweenInfo.new(0.2), {Color = Theme.Outline})
                        end
                    end
                end)
                
                -- Register config callback (triggers actual callback so feature activates on config load)
                Window._configCallbacks[configKey] = function(val)
                    if val then
                        setKey(Enum.KeyCode[val], false) -- false = DO trigger callback
                    else
                        setKey(nil, false)
                    end
                end
                if key then
                    Window._configValues[configKey] = key.Name
                end
                
                table.insert(Window.Elements, {Type = "Keybind", Name = kName, Obj = Frame, Section = title, Tab = name, Container = Container})
                return {
                    Frame = Frame,
                    Set = function(_, k) setKey(k) end,
                    Get = function() return key end,
                    SetVisible = function(_, visible) Frame.Visible = visible end
                }
            end
            
            function Section:AddTextbox(opts)
                local tName = opts.Name or "Textbox"
                local configKey = opts.ConfigKey or tName
                local callback = opts.Callback or function() end
                
                local Frame = Utility:Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundTransparency = 1,
                    Parent = ItemsDiv
                })
                
                local Label = Utility:Create("TextLabel", {
                    Text = tName,
                    Size = UDim2.new(0, 100, 1, 0),
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = Frame
                })
                
                local Input = Utility:Create("TextBox", {
                    Size = UDim2.new(0, 120, 0, 24),
                    Position = UDim2.new(1, -120, 0.5, -12),
                    BackgroundColor3 = Theme.Element,
                    Text = opts.Default or "",
                    PlaceholderText = opts.Placeholder or "Type here...",
                    TextColor3 = Theme.Text,
                    PlaceholderColor3 = Theme.SubText,
                    Font = Enum.Font.Gotham,
                    TextSize = 13,
                    ClearTextOnFocus = false,
                    Parent = Frame,
                    ClipsDescendants = true
                })
                Utility:Corner(Input, 4)
                local InputStroke = Utility:Stroke(Input, Theme.Outline, 1)
                
                Input.Focused:Connect(function()
                    Utility:Tween(Input, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Section})
                    Utility:Tween(InputStroke, TweenInfo.new(0.2), {Color = Theme.Accent})
                end)
                
                Input.FocusLost:Connect(function()
                    Utility:Tween(Input, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Element})
                    Utility:Tween(InputStroke, TweenInfo.new(0.2), {Color = Theme.Outline})
                    Window._configValues[configKey] = Input.Text
                    callback(Input.Text)
                end)
                
                -- Register config callback (triggers actual callback so feature activates on config load)
                Window._configCallbacks[configKey] = function(val)
                    Input.Text = val or ""
                    Window._configValues[configKey] = val or ""
                    callback(val or "") -- Trigger callback so feature activates
                end
                Window._configValues[configKey] = Input.Text
                
                table.insert(Window.Elements, {Type = "Textbox", Name = tName, Obj = Frame, Section = title, Tab = name, Container = Container})
                return {
                    Frame = Frame,
                    Set = function(_, text) Input.Text = text; Window._configValues[configKey] = text end,
                    Get = function() return Input.Text end,
                    SetVisible = function(_, visible) Frame.Visible = visible end
                }
            end
            
            function Section:AddLabel(text)
                local Label = Utility:Create("TextLabel", {
                    Size = UDim2.new(1, 0, 0, 24),
                    BackgroundTransparency = 1,
                    Text = text,
                    TextColor3 = Theme.SubText,
                    Font = Enum.Font.Gotham,
                    TextSize = 12,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = ItemsDiv
                })
                
                return {
                    Label = Label,
                    Set = function(_, newText) Label.Text = newText end,
                    SetVisible = function(_, visible) Label.Visible = visible end
                }
            end
            
            function Section:AddColorPicker(opts)
                local cName = opts.Name or "Color"
                local configKey = opts.ConfigKey or cName
                local default = opts.Default or Color3.fromRGB(255, 255, 255)
                local defaultAlpha = opts.DefaultAlpha or 1
                local callback = opts.Callback or function() end
                
                local currentColor = default
                local currentAlpha = defaultAlpha
                local pickerOpen = false
                
                -- Store slider values directly
                local rValue = math.floor(default.R * 255)
                local gValue = math.floor(default.G * 255)
                local bValue = math.floor(default.B * 255)
                local alphaValue = defaultAlpha
                
                local Frame = Utility:Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundTransparency = 1,
                    Parent = ItemsDiv,
                    ClipsDescendants = false
                })
                
                local Label = Utility:Create("TextLabel", {
                    Text = cName,
                    Size = UDim2.new(1, -50, 1, 0),
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = Frame
                })
                
                local ColorBtn = Utility:Create("TextButton", {
                    Size = UDim2.new(0, 40, 0, 24),
                    Position = UDim2.new(1, -40, 0.5, -12),
                    BackgroundColor3 = default,
                    Text = "",
                    AutoButtonColor = false,
                    Parent = Frame
                })
                Utility:Corner(ColorBtn, 6)
                Utility:Stroke(ColorBtn, Theme.Outline, 2)
                
                -- Color picker popup (wider for alpha slider)
                local PickerFrame = Utility:Create("Frame", {
                    Size = UDim2.new(0, 230, 0, 120),
                    Position = UDim2.new(1, -230, 0, 36),
                    BackgroundColor3 = Theme.Section,
                    Visible = false,
                    ZIndex = 100,
                    Parent = Frame
                })
                Utility:Corner(PickerFrame, 8)
                Utility:Stroke(PickerFrame, Theme.Outline, 1)
                
                -- Live color preview box
                local PreviewBox = Utility:Create("Frame", {
                    Size = UDim2.new(0, 40, 0, 40),
                    Position = UDim2.new(0, 10, 0, 10),
                    BackgroundColor3 = default,
                    ZIndex = 101,
                    Parent = PickerFrame
                })
                Utility:Corner(PreviewBox, 6)
                Utility:Stroke(PreviewBox, Theme.Outline, 1)
                
                -- Function to update live preview
                local function updatePreview()
                    local color = Color3.fromRGB(rValue, gValue, bValue)
                    PreviewBox.BackgroundColor3 = color
                    PreviewBox.BackgroundTransparency = 1 - alphaValue
                    ColorBtn.BackgroundColor3 = color
                    ColorBtn.BackgroundTransparency = 1 - alphaValue
                    currentColor = color
                    currentAlpha = alphaValue
                    Window._configValues[configKey] = {R = rValue, G = gValue, B = bValue, A = alphaValue}
                    callback(color, alphaValue)
                end
                
                -- RGB Sliders (positioned to the right of preview)
                local sliderRefs = {}
                
                local function createColorSlider(label, yPos, defaultVal, colorComponent, valueRef)
                    local SliderFrame = Utility:Create("Frame", {
                        Size = UDim2.new(0, 140, 0, 24),
                        Position = UDim2.new(0, 55, 0, yPos),
                        BackgroundTransparency = 1,
                        ZIndex = 101,
                        Parent = PickerFrame
                    })
                    
                    local SliderLabel = Utility:Create("TextLabel", {
                        Text = label,
                        Size = UDim2.new(0, 14, 1, 0),
                        BackgroundTransparency = 1,
                        TextColor3 = colorComponent,
                        Font = Enum.Font.GothamBold,
                        TextSize = 10,
                        ZIndex = 101,
                        Parent = SliderFrame
                    })
                    
                    local Track = Utility:Create("Frame", {
                        Size = UDim2.new(0, 95, 0, 8),
                        Position = UDim2.new(0, 18, 0.5, -4),
                        BackgroundColor3 = Theme.Element,
                        ZIndex = 101,
                        Parent = SliderFrame
                    })
                    Utility:Corner(Track, 4)
                    
                    local Fill = Utility:Create("Frame", {
                        Size = UDim2.new(defaultVal/255, 0, 1, 0),
                        BackgroundColor3 = colorComponent,
                        ZIndex = 102,
                        Parent = Track
                    })
                    Utility:Corner(Fill, 4)
                    
                    local ValueLbl = Utility:Create("TextLabel", {
                        Text = tostring(math.floor(defaultVal)),
                        Size = UDim2.new(0, 25, 1, 0),
                        Position = UDim2.new(0, 115, 0, 0),
                        BackgroundTransparency = 1,
                        TextColor3 = Theme.SubText,
                        Font = Enum.Font.Gotham,
                        TextSize = 9,
                        ZIndex = 101,
                        Parent = SliderFrame
                    })
                    
                    local dragging = false
                    
                    local function updateSlider(x)
                        local val = math.floor(math.clamp(x, 0, 1) * 255)
                        Fill.Size = UDim2.new(x, 0, 1, 0)
                        ValueLbl.Text = tostring(val)
                        return val
                    end
                    
                    Track.InputBegan:Connect(function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            dragging = true
                            local x = math.clamp((input.Position.X - Track.AbsolutePosition.X) / Track.AbsoluteSize.X, 0, 1)
                            if valueRef == "R" then rValue = updateSlider(x)
                            elseif valueRef == "G" then gValue = updateSlider(x)
                            elseif valueRef == "B" then bValue = updateSlider(x) end
                            updatePreview()
                        end
                    end)
                    
                    Track.InputEnded:Connect(function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            dragging = false
                        end
                    end)
                    
                    UserInputService.InputChanged:Connect(function(input)
                        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                            local x = math.clamp((input.Position.X - Track.AbsolutePosition.X) / Track.AbsoluteSize.X, 0, 1)
                            if valueRef == "R" then rValue = updateSlider(x)
                            elseif valueRef == "G" then gValue = updateSlider(x)
                            elseif valueRef == "B" then bValue = updateSlider(x) end
                            updatePreview()
                        end
                    end)
                    
                    UserInputService.InputEnded:Connect(function(input)
                        if dragging then
                            dragging = false
                        end
                    end)
                    
                    return {
                        SetValue = function(v)
                            local x = v / 255
                            Fill.Size = UDim2.new(x, 0, 1, 0)
                            ValueLbl.Text = tostring(math.floor(v))
                        end
                    }
                end
                
                sliderRefs.R = createColorSlider("R", 10, rValue, Color3.fromRGB(255, 100, 100), "R")
                sliderRefs.G = createColorSlider("G", 42, gValue, Color3.fromRGB(100, 255, 100), "G")
                sliderRefs.B = createColorSlider("B", 74, bValue, Color3.fromRGB(100, 100, 255), "B")
                
                -- Vertical Alpha Slider on the right side
                local AlphaFrame = Utility:Create("Frame", {
                    Size = UDim2.new(0, 20, 0, 100),
                    Position = UDim2.new(1, -28, 0, 10),
                    BackgroundTransparency = 1,
                    ZIndex = 101,
                    Parent = PickerFrame
                })
                
                local AlphaLabel = Utility:Create("TextLabel", {
                    Text = "A",
                    Size = UDim2.new(1, 0, 0, 12),
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.SubText,
                    Font = Enum.Font.GothamBold,
                    TextSize = 9,
                    ZIndex = 101,
                    Parent = AlphaFrame
                })
                
                local AlphaTrack = Utility:Create("Frame", {
                    Size = UDim2.new(0, 8, 0, 70),
                    Position = UDim2.new(0.5, -4, 0, 14),
                    BackgroundColor3 = Theme.Element,
                    ZIndex = 101,
                    Parent = AlphaFrame
                })
                Utility:Corner(AlphaTrack, 4)
                
                -- Gradient for alpha track (white to transparent)
                local AlphaGradient = Utility:Create("UIGradient", {
                    Color = ColorSequence.new(Color3.new(1, 1, 1), Color3.new(0.3, 0.3, 0.3)),
                    Rotation = 90,
                    Parent = AlphaTrack
                })
                
                local AlphaFill = Utility:Create("Frame", {
                    Size = UDim2.new(1, 0, defaultAlpha, 0),
                    Position = UDim2.new(0, 0, 1 - defaultAlpha, 0),
                    BackgroundColor3 = Theme.Accent,
                    ZIndex = 102,
                    Parent = AlphaTrack
                })
                Utility:Corner(AlphaFill, 4)
                
                local AlphaValueLbl = Utility:Create("TextLabel", {
                    Text = tostring(math.floor(defaultAlpha * 100)) .. "%",
                    Size = UDim2.new(1, 0, 0, 12),
                    Position = UDim2.new(0, 0, 1, -12),
                    BackgroundTransparency = 1,
                    TextColor3 = Theme.SubText,
                    Font = Enum.Font.Gotham,
                    TextSize = 8,
                    ZIndex = 101,
                    Parent = AlphaFrame
                })
                
                local alphaDragging = false
                
                local function updateAlphaSlider(y)
                    alphaValue = 1 - y
                    AlphaFill.Size = UDim2.new(1, 0, alphaValue, 0)
                    AlphaFill.Position = UDim2.new(0, 0, 1 - alphaValue, 0)
                    AlphaValueLbl.Text = tostring(math.floor(alphaValue * 100)) .. "%"
                end
                
                AlphaTrack.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                        alphaDragging = true
                        local y = math.clamp((input.Position.Y - AlphaTrack.AbsolutePosition.Y) / AlphaTrack.AbsoluteSize.Y, 0, 1)
                        updateAlphaSlider(y)
                        updatePreview()
                    end
                end)
                
                AlphaTrack.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                        alphaDragging = false
                    end
                end)
                
                UserInputService.InputChanged:Connect(function(input)
                    if alphaDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                        local y = math.clamp((input.Position.Y - AlphaTrack.AbsolutePosition.Y) / AlphaTrack.AbsoluteSize.Y, 0, 1)
                        updateAlphaSlider(y)
                        updatePreview()
                    end
                end)
                
                UserInputService.InputEnded:Connect(function(input)
                    if alphaDragging then
                        alphaDragging = false
                    end
                end)
                
                ColorBtn.MouseButton1Click:Connect(function()
                    pickerOpen = not pickerOpen
                    if pickerOpen then
                        PickerFrame.Size = UDim2.new(0, 230, 0, 0)
                        PickerFrame.Visible = true
                        Utility:Tween(PickerFrame, TweenInfo.new(0.2, Enum.EasingStyle.Back), {Size = UDim2.new(0, 230, 0, 120)})
                    else
                        Utility:Tween(PickerFrame, TweenInfo.new(0.15), {Size = UDim2.new(0, 230, 0, 0)})
                        task.delay(0.15, function() PickerFrame.Visible = false end)
                    end
                end)
                
                -- Config callbacks (triggers actual callback so feature activates on config load)
                Window._configCallbacks[configKey] = function(val)
                    if val and val.R then
                        rValue = val.R
                        gValue = val.G
                        bValue = val.B
                        sliderRefs.R.SetValue(val.R)
                        sliderRefs.G.SetValue(val.G)
                        sliderRefs.B.SetValue(val.B)
                        if val.A then
                            alphaValue = val.A
                            AlphaFill.Size = UDim2.new(1, 0, alphaValue, 0)
                            AlphaFill.Position = UDim2.new(0, 0, 1 - alphaValue, 0)
                            AlphaValueLbl.Text = tostring(math.floor(alphaValue * 100)) .. "%"
                        end
                        currentColor = Color3.fromRGB(val.R, val.G, val.B)
                        currentAlpha = val.A or 1
                        ColorBtn.BackgroundColor3 = currentColor
                        ColorBtn.BackgroundTransparency = 1 - currentAlpha
                        PreviewBox.BackgroundColor3 = currentColor
                        PreviewBox.BackgroundTransparency = 1 - currentAlpha
                        Window._configValues[configKey] = {R = rValue, G = gValue, B = bValue, A = alphaValue}
                        callback(currentColor, currentAlpha) -- Trigger callback so feature activates
                    end
                end
                Window._configValues[configKey] = {R = rValue, G = gValue, B = bValue, A = alphaValue}
                
                table.insert(Window.Elements, {Type = "ColorPicker", Name = cName, Obj = Frame, Section = title, Tab = name, Container = Container})
                return {
                    Set = function(_, color, alpha)
                        alpha = alpha or 1
                        rValue = math.floor(color.R * 255)
                        gValue = math.floor(color.G * 255)
                        bValue = math.floor(color.B * 255)
                        alphaValue = alpha
                        sliderRefs.R.SetValue(rValue)
                        sliderRefs.G.SetValue(gValue)
                        sliderRefs.B.SetValue(bValue)
                        AlphaFill.Size = UDim2.new(1, 0, alpha, 0)
                        AlphaFill.Position = UDim2.new(0, 0, 1 - alpha, 0)
                        AlphaValueLbl.Text = tostring(math.floor(alpha * 100)) .. "%"
                        updatePreview()
                    end,
                    Get = function() return currentColor, currentAlpha end,
                    SetVisible = function(_, visible) Frame.Visible = visible end
                }
            end
            
            return Section
        end
        
        return Tab
    end
    
    function Window:Notify(opts)
        local title = opts.Title or "Notification"
        local text = opts.Text or ""
        local dur = opts.Duration or 3
        
        -- Reuse toast container or create new
        local ToastArea = ScreenGui:FindFirstChild("Toasts")
        if not ToastArea then
            ToastArea = Utility:Create("Frame", {
                Name = "Toasts",
                Size = UDim2.new(0, 300, 0.8, 0),
                Position = UDim2.new(1, -20, 1, -50),
                AnchorPoint = Vector2.new(1, 1),
                BackgroundTransparency = 1,
                Parent = ScreenGui
            })
            Utility:Create("UIListLayout", {
                VerticalAlignment = Enum.VerticalAlignment.Bottom,
                HorizontalAlignment = Enum.HorizontalAlignment.Right,
                Padding = UDim.new(0, 10),
                Parent = ToastArea
            })
        end
        
        -- Wrapper for layout animation
        local Wrapper = Utility:Create("Frame", {
            Name = "Wrapper",
            Size = UDim2.new(1, 0, 0, 60),
            BackgroundTransparency = 1,
            Parent = ToastArea
        })
        
        local Toast = Utility:Create("Frame", {
            Size = UDim2.new(1, 0, 1, 0),
            Position = UDim2.new(1.2, 0, 0, 0), -- Start off-screen
            BackgroundColor3 = Theme.Content,
            BackgroundTransparency = 0.1,
            Parent = Wrapper
        })
        Utility:Corner(Toast, 8)
        Utility:Stroke(Toast, Theme.Outline, 1)
        
        -- Glow strip
        local Strip = Utility:Create("Frame", {
            Size = UDim2.new(0, 4, 1, 0),
            BackgroundColor3 = Theme.Accent,
            Parent = Toast
        })
        Utility:Corner(Strip, 2)
        
        Utility:Create("TextLabel", {
            Text = title,
            Size = UDim2.new(1, -15, 0, 20),
            Position = UDim2.new(0, 15, 0, 10),
            BackgroundTransparency = 1,
            TextColor3 = Theme.Text,
            Font = Enum.Font.GothamBold,
            TextSize = 14,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = Toast
        })
        
        Utility:Create("TextLabel", {
            Text = text,
            Size = UDim2.new(1, -15, 0, 20),
            Position = UDim2.new(0, 15, 0, 30),
            BackgroundTransparency = 1,
            TextColor3 = Theme.SubText,
            Font = Enum.Font.Gotham,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = Toast
        })
        
        -- Entrance Animation (Slide In)
        Utility:Tween(Toast, TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Position = UDim2.new(0, 0, 0, 0)})
        
        task.delay(dur, function()
            -- Exit Animation (Slide Out)
            Utility:Tween(Toast, TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {Position = UDim2.new(1.2, 0, 0, 0)})
            task.wait(0.5)
            Wrapper:Destroy()
        end)
    end
    
    function Window:SettingsTab()
        local S = Window:AddTab("Settings", "rbxassetid://0")
        
        -- Configurations Section
        local ConfigSec = S:AddSection("Configurations")
        
        local configName = ""
        ConfigSec:AddTextbox({
            Name = "Config Name",
            Placeholder = "Enter name...",
            ConfigKey = "_internal_configname",
            Callback = function(text)
                configName = text
            end
        })
        
        -- Auto-refreshing config dropdown
        local configList
        local function refreshConfigs()
            local configs = Window:GetConfigs()
            if configList and configList.Refresh then
                configList.Refresh(configs)
            end
            return configs
        end
        
        configList = ConfigSec:AddDropdown({
            Name = "Configs",
            Options = refreshConfigs(),
            Default = nil,
            ConfigKey = "_internal_configlist"
        })
        
        ConfigSec:AddButton({
            Name = "Save Config",
            Callback = function()
                if configName ~= "" then
                    Window:SaveConfig(configName)
                    Window:Notify({Title = "Config", Text = "Saved: " .. configName, Duration = 2})
                    refreshConfigs()
                else
                    Window:Notify({Title = "Error", Text = "Enter a config name first", Duration = 2})
            end
        end
        })
        
        ConfigSec:AddButton({
            Name = "Load Config",
            Callback = function()
                local sel = configList.Get()
                if sel and sel ~= "None" then
                    Window:LoadConfig(sel)
                    Window:Notify({Title = "Config", Text = "Loaded: " .. sel, Duration = 2})
                else
                    Window:Notify({Title = "Error", Text = "Select a config first", Duration = 2})
            end
        end
        })
        
        ConfigSec:AddButton({
            Name = "Delete Config",
            Callback = function()
                local sel = configList.Get()
                if sel and sel ~= "None" then
                    Window:DeleteConfig(sel)
                    Window:Notify({Title = "Config", Text = "Deleted: " .. sel, Duration = 2})
                    refreshConfigs()
        end
    end
        })
        
        -- Auto Load Section
        local AutoSec = S:AddSection("Auto Load")
        
        local autoLoadLabel = AutoSec:AddLabel("Current: " .. (getAutoLoadConfig() or "None"))
        
        AutoSec:AddButton({
            Name = "Set Auto Load",
            Callback = function()
                local sel = configList.Get()
                if sel and sel ~= "None" then
                    Window:SetAutoLoad(sel)
                    autoLoadLabel.Set(nil, "Current: " .. sel)
                    Window:Notify({Title = "Config", Text = "Auto Load set to: " .. sel, Duration = 2})
                end
            end
        })
        
        AutoSec:AddButton({
            Name = "Clear Auto Load",
            Callback = function()
                Window:ClearAutoLoad()
                autoLoadLabel.Set(nil, "Current: None")
                Window:Notify({Title = "Config", Text = "Auto Load cleared", Duration = 2})
            end
        })
        
        -- UI Settings Section
        local UISec = S:AddSection("UI Settings")
        
        UISec:AddKeybind({
            Name = "Toggle Key",
            Default = Window._toggleKey,
            ConfigKey = "_internal_togglekey",
            Callback = function(key)
                Window._toggleKey = key
            end
        })
        
        UISec:AddButton({
            Name = "Unload UI",
            Callback = function()
                Close()
                ScreenGui:Destroy()
            end
        })
        
        return S
    end
    
    --// Search Logic
    local SearchStroke = SearchBg:FindFirstChildOfClass("UIStroke")
    
    -- Search Results Dropdown
    local SearchResults = Utility:Create("Frame", {
        Name = "SearchResults",
        Size = UDim2.new(1, 0, 0, 0),
        Position = UDim2.new(0, 0, 1, 5),
        BackgroundColor3 = Theme.Section,
        BackgroundTransparency = 0.05,
        Visible = false,
        Parent = SearchBg,
        ZIndex = 100,
        ClipsDescendants = true
    })
    Utility:Corner(SearchResults, 8)
    Utility:Stroke(SearchResults, Theme.Outline, 1)
    
    local ResultsScroll = Utility:Create("ScrollingFrame", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 2,
        ScrollBarImageColor3 = Theme.Accent,
        Parent = SearchResults,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollingDirection = Enum.ScrollingDirection.Y,
        ElasticBehavior = Enum.ElasticBehavior.Never,
        ZIndex = 100
    })
    
    local ResultsLayout = Utility:Create("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 2),
        Parent = ResultsScroll
    })
    Utility:Create("UIPadding", {
        PaddingTop = UDim.new(0, 5),
        PaddingLeft = UDim.new(0, 5),
        PaddingRight = UDim.new(0, 5),
        PaddingBottom = UDim.new(0, 5),
        Parent = ResultsScroll
    })
    
    local function ClearResults()
        for _, child in pairs(ResultsScroll:GetChildren()) do
            if child:IsA("Frame") or child:IsA("TextButton") or child:IsA("TextLabel") then
                child:Destroy()
            end
        end
    end
    
    local function HighlightElement(el)
        -- Flash animation to draw attention
        if not el.Obj or not el.Obj.Parent then return end
        local originalColor = el.Obj.BackgroundColor3
        for i = 1, 3 do
            Utility:Tween(el.Obj, TweenInfo.new(0.15), {BackgroundColor3 = Theme.Accent})
            task.wait(0.15)
            Utility:Tween(el.Obj, TweenInfo.new(0.15), {BackgroundColor3 = originalColor})
            task.wait(0.15)
        end
    end
    
    local function MatchesQuery(text, query)
        if not text or not query then return false end
        local lowerText = text:lower()
        local lowerQuery = query:lower()
        
        -- Exact match first
        if lowerText == lowerQuery then return true, 100 end
        
        -- Starts with query
        if lowerText:sub(1, #lowerQuery) == lowerQuery then return true, 90 end
        
        -- Contains query
        if lowerText:find(lowerQuery, 1, true) then return true, 80 end
        
        -- Fuzzy match - all query chars appear in order
        local queryIdx = 1
        for i = 1, #lowerText do
            if lowerText:sub(i, i) == lowerQuery:sub(queryIdx, queryIdx) then
                queryIdx = queryIdx + 1
                if queryIdx > #lowerQuery then
                    return true, 50
            end
        end
        end
        
        return false, 0
    end
    
    local function CreateSectionHeader(sectionName, tabName)
        local Header = Utility:Create("Frame", {
            Size = UDim2.new(1, 0, 0, 24),
            BackgroundColor3 = Theme.Sidebar,
            BackgroundTransparency = 0.3,
            Parent = ResultsScroll,
            ZIndex = 101
        })
        Utility:Corner(Header, 4)
        
        Utility:Create("TextLabel", {
            Text = "📁 " .. sectionName,
            Size = UDim2.new(0.6, 0, 1, 0),
            Position = UDim2.new(0, 8, 0, 0),
            BackgroundTransparency = 1,
            TextColor3 = Theme.Accent,
            Font = Enum.Font.GothamBold,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = Header,
            ZIndex = 101
        })
        
        Utility:Create("TextLabel", {
            Text = tabName,
            Size = UDim2.new(0.4, -8, 1, 0),
            Position = UDim2.new(0.6, 0, 0, 0),
            BackgroundTransparency = 1,
            TextColor3 = Theme.SubText,
            Font = Enum.Font.Gotham,
            TextSize = 10,
            TextXAlignment = Enum.TextXAlignment.Right,
            Parent = Header,
            ZIndex = 101
        })
        
        return Header
    end
    
    local function CreateFeatureItem(el)
        local ResultBtn = Utility:Create("TextButton", {
            Size = UDim2.new(1, 0, 0, 26),
            BackgroundColor3 = Theme.Element,
            BackgroundTransparency = 0.7,
            Text = "",
            AutoButtonColor = false,
            Parent = ResultsScroll,
            ClipsDescendants = true,
            ZIndex = 101
        })
        Utility:Corner(ResultBtn, 4)
        
        local NameLbl = Utility:Create("TextLabel", {
            Text = el.Name,
            Size = UDim2.new(1, -60, 1, 0),
            Position = UDim2.new(0, 12, 0, 0),
            BackgroundTransparency = 1,
            TextColor3 = Theme.Text,
            Font = Enum.Font.Gotham,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextTruncate = Enum.TextTruncate.AtEnd,
            Parent = ResultBtn,
            ZIndex = 101
        })
        
        Utility:Create("TextLabel", {
            Text = el.Type,
            Size = UDim2.new(0, 50, 1, 0),
            Position = UDim2.new(1, -55, 0, 0),
            BackgroundTransparency = 1,
            TextColor3 = Theme.SubText,
            Font = Enum.Font.Gotham,
            TextSize = 9,
            Parent = ResultBtn,
            ZIndex = 101
        })
        
        -- Hover effect
        ResultBtn.MouseEnter:Connect(function()
            Utility:Tween(ResultBtn, TweenInfo.new(0.15), {BackgroundTransparency = 0.3, BackgroundColor3 = Theme.Accent})
            Utility:Tween(NameLbl, TweenInfo.new(0.15), {TextColor3 = Color3.new(1, 1, 1)})
        end)
        
        ResultBtn.MouseLeave:Connect(function()
            Utility:Tween(ResultBtn, TweenInfo.new(0.15), {BackgroundTransparency = 0.7, BackgroundColor3 = Theme.Element})
            Utility:Tween(NameLbl, TweenInfo.new(0.15), {TextColor3 = Theme.Text})
        end)
        
        -- Click to navigate
        ResultBtn.MouseButton1Click:Connect(function()
            -- Switch to the tab
            if el.Tab then
                Window:SelectTab(el.Tab)
            end
            
            -- Close search results
            SearchResults.Visible = false
            SearchBox.Text = ""
            
            -- Scroll to element and highlight it
            task.defer(function()
                task.wait(0.1) -- Wait for tab switch
                if el.Obj and el.Obj.Parent then
                    local page = nil
                    for _, t in pairs(Window.Tabs) do
                        if el.Obj:IsDescendantOf(t.Page) then
                            page = t.Page
                            break
                        end
                    end
                    
                    if page then
                        -- Scroll to container (section) first
                        local container = el.Container
                        if container then
                            local containerPos = container.AbsolutePosition.Y - page.AbsolutePosition.Y + page.CanvasPosition.Y
                            page.CanvasPosition = Vector2.new(0, math.max(0, containerPos - 20))
        end
    end
    
                    -- Highlight the element
                    task.spawn(function()
                        HighlightElement(el)
                    end)
                end
            end)
        end)
        
        return ResultBtn
    end
    
    local function PerformSearch(query)
        ClearResults()
        
        if query == "" or #query < 1 then
            SearchResults.Visible = false
            Utility:Tween(SearchResults, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 0)})
            return
        end
        
        -- Group matches by section
        local sectionMatches = {}
        local totalMatches = 0
        
        for _, el in pairs(Window.Elements) do
            local matches, score = MatchesQuery(el.Name, query)
            if matches then
                local key = (el.Tab or "Unknown") .. "|" .. (el.Section or "General")
                if not sectionMatches[key] then
                    sectionMatches[key] = {
                        tab = el.Tab,
                        section = el.Section,
                        elements = {},
                        maxScore = 0
                    }
                end
                table.insert(sectionMatches[key].elements, {el = el, score = score})
                if score > sectionMatches[key].maxScore then
                    sectionMatches[key].maxScore = score
                end
                totalMatches = totalMatches + 1
            end
        end
        
        if totalMatches == 0 then
            -- Show "No results" message
            Utility:Create("TextLabel", {
                Name = "NoResults",
                Size = UDim2.new(1, 0, 0, 32),
                BackgroundTransparency = 1,
                Text = "No results for '" .. query .. "'",
                TextColor3 = Theme.SubText,
                Font = Enum.Font.Gotham,
                TextSize = 12,
                Parent = ResultsScroll,
                ZIndex = 101
            })
            SearchResults.Visible = true
            Utility:Tween(SearchResults, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 42)})
        else
            -- Sort sections by max score
            local sortedSections = {}
            for key, data in pairs(sectionMatches) do
                table.insert(sortedSections, data)
            end
            table.sort(sortedSections, function(a, b) return a.maxScore > b.maxScore end)
            
            -- Create grouped results
            local itemCount = 0
            for _, sectionData in ipairs(sortedSections) do
                -- Section header
                CreateSectionHeader(sectionData.section or "General", sectionData.tab or "Unknown")
                itemCount = itemCount + 1
                
                -- Sort elements by score within section
                table.sort(sectionData.elements, function(a, b) return a.score > b.score end)
                
                -- Feature items
                for _, match in ipairs(sectionData.elements) do
                    CreateFeatureItem(match.el)
                    itemCount = itemCount + 1
                end
            end
            
            -- Calculate height (24 for headers, 26 for items, plus padding)
            local height = math.min(itemCount * 28 + 15, 250)
            SearchResults.Visible = true
            Utility:Tween(SearchResults, TweenInfo.new(0.15, Enum.EasingStyle.Quart), {Size = UDim2.new(1, 0, 0, height)})
        end
    end
    
    SearchBox.Focused:Connect(function()
        Utility:Tween(SearchBg, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Element})
        if SearchStroke then Utility:Tween(SearchStroke, TweenInfo.new(0.2), {Color = Theme.Accent}) end
        
        -- Show results if there's text
        if SearchBox.Text ~= "" then
            PerformSearch(SearchBox.Text)
        end
    end)
    
    SearchBox.FocusLost:Connect(function()
        Utility:Tween(SearchBg, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Section})
        if SearchStroke then Utility:Tween(SearchStroke, TweenInfo.new(0.2), {Color = Theme.Outline}) end
        
        -- Hide results after a short delay (allows clicking results)
        task.delay(0.2, function()
            if not SearchBox:IsFocused() then
                Utility:Tween(SearchResults, TweenInfo.new(0.15), {Size = UDim2.new(1, 0, 0, 0)})
                task.wait(0.15)
                SearchResults.Visible = false
            end
        end)
    end)
    
    SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
        PerformSearch(SearchBox.Text)
    end)
    
    -- Auto-load config if set
    local autoLoadName = getAutoLoadConfig()
    if autoLoadName then
        task.defer(function()
            task.wait(0.1) -- Wait for UI to be built
            local data = loadConfig(autoLoadName)
    if data then
        for key, val in pairs(data) do
                    Window._configValues[key] = val
                    if Window._configCallbacks[key] then
                        pcall(Window._configCallbacks[key], val)
            end
        end
            end
        end)
    end
    
    --// Mobile Toggle Button
    if IS_MOBILE then
        local mobileToggleDragging = false
        local mobileToggleDragStart = nil
        local mobileToggleStartPos = nil
        local mobileToggleMoved = false
        local uiVisible = true
        
        -- Position at TOP-RIGHT corner so it's always visible above the UI
        local MobileToggle = Utility:Create("TextButton", {
            Name = "MobileToggle",
            Size = UDim2.new(0, 44, 0, 44),
            Position = UDim2.new(1, -55, 0, 10), -- Top-right corner
            BackgroundColor3 = Theme.Accent,
            BackgroundTransparency = 0.1,
            Text = "",
            AutoButtonColor = false,
            ZIndex = 9999, -- Very high ZIndex to always be on top
            Parent = ScreenGui
        })
        Utility:Corner(MobileToggle, 22)
        Utility:Stroke(MobileToggle, Theme.Text, 2)
        
        -- Icon inside (eye icon for show/hide)
        local MobileIcon = Utility:Create("TextLabel", {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = "👁", -- Eye icon
            TextColor3 = Theme.Background,
            Font = Enum.Font.GothamBold,
            TextSize = 20,
            ZIndex = 10000,
            Parent = MobileToggle
        })
        
        -- Dragging logic (without activating)
        MobileToggle.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
                mobileToggleDragging = true
                mobileToggleMoved = false
                mobileToggleDragStart = input.Position
                mobileToggleStartPos = MobileToggle.Position
                
                -- Scale down on touch
                Utility:Tween(MobileToggle, TweenInfo.new(0.1), {Size = UDim2.new(0, 40, 0, 40)})
            end
        end)
        
        MobileToggle.InputChanged:Connect(function(input)
            if mobileToggleDragging and (input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement) then
                local delta = input.Position - mobileToggleDragStart
                -- Only count as moved if dragged more than 10 pixels
                if delta.Magnitude > 10 then
                    mobileToggleMoved = true
                end
                MobileToggle.Position = UDim2.new(
                    mobileToggleStartPos.X.Scale,
                    mobileToggleStartPos.X.Offset + delta.X,
                    mobileToggleStartPos.Y.Scale,
                    mobileToggleStartPos.Y.Offset + delta.Y
                )
            end
        end)
        
        MobileToggle.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
                mobileToggleDragging = false
                
                -- Scale back
                Utility:Tween(MobileToggle, TweenInfo.new(0.15, Enum.EasingStyle.Back), {Size = UDim2.new(0, 44, 0, 44)})
                
                -- Only toggle if not dragged
                if not mobileToggleMoved then
                    uiVisible = not uiVisible
                    if uiVisible then
                        Open()
                        MobileIcon.Text = "👁"
                        Utility:Tween(MobileToggle, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Accent})
                    else
                        Close()
                        MobileIcon.Text = "👁‍🗨"
                        Utility:Tween(MobileToggle, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Element})
                    end
                end
            end
        end)
        
        -- Global touch movement tracking
        UserInputService.InputChanged:Connect(function(input)
            if mobileToggleDragging and (input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement) then
                local delta = input.Position - mobileToggleDragStart
                if delta.Magnitude > 10 then
                    mobileToggleMoved = true
                end
                MobileToggle.Position = UDim2.new(
                    mobileToggleStartPos.X.Scale,
                    mobileToggleStartPos.X.Offset + delta.X,
                    mobileToggleStartPos.Y.Scale,
                    mobileToggleStartPos.Y.Offset + delta.Y
                )
            end
        end)
    end
    
    -- Initialize
    Open()
    
    return Window
end

return Library 
